{"version":3,"sources":["meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/common/unify.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/common/default_error_filters.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/common/send.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/models/base_error.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/models/0model.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/models/methods.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/models/pubsub.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/models/system.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/models/errors.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/jobs.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/retry.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/utils.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/ntp.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/wait_time_builder.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/check_for_oplog.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/tracer/tracer.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/tracer/default_filters.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/tracer/tracer_store.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/docsize_cache.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/kadira.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/wrap_server.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/wrap_session.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/wrap_subscription.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/wrap_observers.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/wrap_ddp_stringify.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/instrument.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/db.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/http.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/email.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/async.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/error.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/set_labels.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/hijack/meteorx.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/environment_variables.js","meteor://ðŸ’»app/packages/mdg:meteor-apm-agent/lib/auto_connect.js"],"names":["Kadira","options","Meteor","wrapAsync","_wrapAsync","isServer","EventEmitter","Npm","require","eventBus","setMaxListeners","buildArgs","args","_","toArray","eventName","slice","unshift","EventBus","forEach","m","arguments","apply","commonErrRegExps","errorFilters","filterValidationErrors","type","message","err","Error","filterCommonMeteorErrors","lc","length","regExp","test","send","payload","path","callback","connected","substr","endpoint","retryCount","retry","Retry","minCount","minTimeout","baseTimeout","maxTimeout","sendFunction","_getSendFunction","tryToSend","retryLater","console","warn","content","statusCode","_serverSend","_clientSend","httpRequest","headers","JSON","stringify","Fiber","httpOptions","data","authHeaders","HTTP","call","res","run","BaseErrorModel","_filters","prototype","addFilter","filter","push","removeFilter","index","indexOf","splice","applyFilters","error","subType","validated","ex","KadiraModel","_getDateId","timestamp","remainder","dateId","METHOD_METRICS_FIELDS","MethodsModel","metricsThreshold","self","methodMetricsByMinute","Object","create","errorMap","_metricsThreshold","assign","maxEventTimesForMethods","tracerStore","TracerStore","interval","maxTotalPoints","archiveEvery","start","_getMetrics","method","methods","count","errors","fetchedDocSize","sentMsgSize","field","setStartTime","metricsByMinute","startTime","processMethod","methodTrace","at","_appendMetrics","errored","name","addTrace","id","methodMetrics","value","metrics","endTime","trackDocSize","size","Ntp","_now","trackMsgSize","buildPayload","buildDetailedInfo","methodRequests","key","syncedDate","syncTime","methodName","collectTraces","each","get","module","link","v","logger","PubsubModel","subscriptions","_trackSub","session","msg","params","publication","_getPublicationName","subscriptionId","subs","_startTime","_trackUnsub","sub","_subscriptionId","_name","subscriptionState","unsubs","lifeTime","_trackReady","trace","readyTracked","resTime","_trackError","pubs","activeSubs","activeDocs","totalObservers","cachedObservers","createdObservers","deletedObservers","observerLifetime","polledDocuments","oplogUpdatedDocuments","oplogInsertedDocuments","oplogDeletedDocuments","initiallyAddedDocuments","liveAddedDocuments","liveChangedDocuments","liveRemovedDocuments","polledDocSize","initiallyFetchedDocSize","liveFetchedDocSize","initiallySentMsgSize","liveSentMsgSize","_getSubscriptionInfo","totalDocsSent","totalDataSent","server","sessions","_namedSubs","countSubData","_universalSubs","avgObserverReuse","countSubscriptions","countDocuments","countObservers","_documents","document","_totalObservers","_cachedObservers","buildDetailInfo","pubMetrics","subscriptionData","dateMetrics","singlePubMetrics","pubRequests","incrementHandleCount","isCached","publicationName","trackCreatedObserver","info","trackDeletedObserver","Date","getTime","trackDocumentChanges","op","trackPolledDocuments","trackLiveUpdates","os","usage","EventLoopMonitor","SystemModel","newSessions","sessionTimeout","usageLookup","stat","bind","evloopMonitor","now","memory","process","memoryUsage","rss","getUsage","pcpu","cpu","cpuInfo","cputime","cpuTime","pcpuUser","pcpuSystem","pctEvloopBlock","status","pctBlock","systemMetrics","pid","docSzCache","setPcpu","handleSessionActivity","countNewSession","isSessionActive","_activeAt","isLocalAddress","socket","inactiveTime","isLocalHostRegex","isLocalAddressRegex","host","address","remoteAddress","ErrorModel","appId","maxErrors","values","metric","errorCount","trackError","errorDef","_formatError","time","stack","details","errorEvent","events","errorObject","stacks","Jobs","getAsync","coreApi","getJob","then","catch","setAsync","changes","updateJob","set","defaults","clone","exponent","fuzz","retryTimer","clear","clearTimeout","_timeout","timeout","Math","min","pow","Random","fraction","ceil","fn","setTimeout","export","collection","Map","Set","HaveAsyncCallback","lastArg","UniqueId","DefaultUniqueId","OptimizedApply","context","a","getLogger","setEndpoint","diff","synced","reSyncCount","reSync","round","localTime","sync","cacheDns","getServerTime","calculateTimeDiff","clientStartTime","serverTime","networkTime","serverStartTime","parseInt","canLogKadira","_localStorage","getItem","log","WAITON_MESSAGE_FIELDS","WaitTimeBuilder","_waitListStore","_currentProcessingMessages","_messageCache","register","msgId","mainKey","_getMessageKey","inQueue","waitList","map","_getCacheMessage","currentlyProcessingMessage","build","filteredWaitList","_cleanCacheMessage","sessionId","cachedMessage","pick","_key","_registered","trackWaitTime","unblock","started","unblocked","wrappedUnblock","waitTime","OplogCheck","_070","cursorDescription","limit","code","reason","solution","exists$","any","selector","onlyScalers","all","Collection","ObjectID","_071","matcher","Minimongo","Matcher","env","MONGO_OPLOG_URL","disableOplog","_disableOplog","miniMongoMatcher","miniMongoSorter","Sorter","sort","sorter","fields","LocalCollection","_checkSupportedProjection","e","skip","where","hasWhere","geo","hasGeoQuery","limitButNoSort","olderVersion","driver","constructor","cursorSupported","gitCheckout","release","preRunningMatchers","globalMatchers","versionMatchers","checkWhyNoOplog","observerDriver","result","runMatchers","meteorVersion","matcherInfo","matched","matcherList","Fibers","eventLogger","REPITITIVE_EVENTS","Tracer","traceInfo","_id","userId","event","lastEvent","getLastEvent","eventId","_lastEventId","_applyFilters","eventEnd","endLastEvent","buildTrace","firstEvent","processedEvents","total","totalNonCompute","prevEventEnd","startEvent","endEvent","computeTime","elapsedTimeForEvent","currentEvent","lastEventData","compute","isEventsProcessed","filterFn","eventType","tracer","stripSensitive","typesToStrip","receiverType","strippedTypes","url","item","stripSelectors","collectionList","collMap","collName","coll","maxTotals","currentMaxTrace","traceArchive","processedCnt","kind","join","EJSON","_handleErrors","traces","_timeoutHandler","setInterval","processTraces","stop","clearInterval","errorKey","erroredTrace","kinds","union","keys","currentMaxTotal","exceedingPoints","archiveDefault","canArchive","_isTraceOutlier","dataSet","_isOutlier","dataPoint","maxMadZ","median","_getMedian","mad","_calculateMad","madZ","_funcMedianDeviation","sortedDataSet","b","_pickQuartile","num","pos","medianDeviations","x","abs","_getMean","dataPoints","point","LRU","crypto","jsonStringify","DocSzCache","maxItems","maxValues","items","max","cpuUsage","getSize","query","opts","getKey","DocSzCacheItem","needsUpdate","doc","element","Buffer","byteLength","addData","getValue","getItemScore","updated","score","reduce","currentTime","timeSinceUpdate","shift","sortNumber","sorted","idx","floor","hostname","KadiraCore","models","currentSub","kadiraInfo","EnvironmentVariable","waitTimeBuilder","pubsub","system","connect","appSecret","payloadTimeout","clientEngineSyncDelay","thresholds","isHostNameSet","proxy","documentSizeCacheSize","last","enableErrorTracking","undefined","addFilterFn","__meteor_runtime_config__","kadira","disableErrorTracking","trim","_checkAuth","_sendAppStats","_schedulePayloadSend","startup","TrackUncaughtExceptions","TrackMeteorDebug","publish","added","ready","_buildPayload","_isDetailedInfo","_countDataSent","_detailInfoSentInterval","appStats","protocolVersion","packageVersions","appVersions","webapp","refreshable","cordova","Package","version","sendData","_sendPayload","_getInfo","currentFiber","useEnvironmentVariable","current","__kadiraInfo","_setInfo","ignoreErrorTracking","_skipKadira","wrapServer","serverProto","originalHandleConnect","_handleConnect","_meteorSession","emit","wrapSession","sessionProto","originalProcessMessage","processMessage","startData","waitEventId","_waitEventId","originalMethodHandler","protocol_handlers","waitOn","response","withValue","orginalSubHandler","orginalUnSubHandler","unsub","originalSend","currentError","method_handlers","handler","wrapMethodHanderForErrors","originalMeteorMethods","methodMap","originalHandler","source","wrapSubscription","subscriptionProto","originalRunHandler","_runHandler","originalReady","_apmReadyTracked","_session","originalError","errorForApm","originalDeactivate","_deactivate","funcName","originalFunc","collectionName","MongoConnection","wrapOplogObserveDriver","proto","originalPublishNewResults","_publishNewResults","newResults","newBuffer","_cursorDescription","docSize","_ownerInfo","_polledDocuments","_docSize","polledFetches","originalHandleOplogEntryQuerying","_handleOplogEntryQuerying","originalHandleOplogEntrySteadyOrFetching","_handleOplogEntrySteadyOrFetching","fnName","originalFn","c","_liveUpdatesCounts","_initialAdds","initialFetches","originalStop","wrapPollingObserveDriver","originalPollMongo","_pollMongo","_results","_map","_polledDocSize","wrapMultiplexer","originalInitalAdd","addHandleAndSendInitialAdds","handle","_firstInitialAddTime","_wasMultiplexerReady","_ready","_queueLength","_queue","_taskHandles","_elapsedPollingTime","wrapForCountingObservers","mongoConnectionProto","originalObserveChanges","_observeChanges","ordered","callbacks","ret","_multiplexer","__kadiraTracked","ownerInfo","_observeDriver","wrapStringifyDDP","originalStringifyDDP","DDPCommon","stringifyDDP","msgString","msgSize","MongoOplogDriver","MongoPollingDriver","Multiplexer","Server","Session","Subscription","instrumented","_startInstrumenting","Promise","asyncApply","hijackDBOps","setLabels","MongoCursor","originalOpen","MongoInternals","RemoteCollectionDriver","open","mongo","Array","func","mod","upsert","endOptions","async","updatedDocs","numberAffected","insertedId","removedDocs","cursorProto","cursor","cursorOptions","endData","oplog","wasMultiplexerReady","queueLength","elapsedPollingTime","observerDriverClass","usesOplog","_cache","docs","noOfCachedDocs","initialPollingTime","_lastPollTime","reasonInfo","noOplogCode","noOplogReason","noOplogSolution","docsFetched","originalCall","Email","originalYield","yield","_apmEventId","originalRun","val","on","printErrorAndKill","_tracked","getTrace","timer","throwError","nextTick","exit","originalMeteorDebug","_debug","kadira_Session_send","originalSendAdds","_sendAdds","kadira_Multiplexer_sendAdds","originalMongoInsert","_insert","kadira_MongoConnection_insert","cb","originalMongoUpdate","_update","kadira_MongoConnection_update","originalMongoRemove","_remove","kadira_MongoConnection_remove","originalPubsubAdded","sendAdded","kadira_Session_sendAdded","originalPubsubChanged","sendChanged","kadira_Session_sendChanged","originalPubsubRemoved","sendRemoved","kadira_Session_sendRemoved","originalCursorForEach","kadira_Cursor_forEach","originalCursorMap","kadira_Cursor_map","originalCursorFetch","fetch","kadira_Cursor_fetch","originalCursorCount","kadira_Cursor_count","originalCursorObserveChanges","observeChanges","kadira_Cursor_observeChanges","originalCursorObserve","observe","kadira_Cursor_observe","originalCursorRewind","rewind","kadira_Cursor_rewind","originalCrossbarListen","DDPServer","_Crossbar","listen","kadira_Crossbar_listen","trigger","originalCrossbarFire","fire","kadira_Crossbar_fire","notification","getSession","fakeSocket","close","support","_removeSession","Mongo","findOne","find","getMultiplexer","mongoDriver","defaultRemoteCollectionDriver","await","getSubscription","subId","_startSubscription","subscription","_stopSubscription","getObserverDriver","multiplexer","getMongoOplogDriver","getMongoPollingDriver","_parseEnv","_options","parser","str","parseBool","toLowerCase","parseUrl","parseString","APM_OPTIONS_CLIENT_ENGINE_SYNC_DELAY","APM_OPTIONS_ERROR_DUMP_INTERVAL","APM_OPTIONS_MAX_ERRORS_PER_INTERVAL","APM_OPTIONS_COLLECT_ALL_STACKS","APM_OPTIONS_ENABLE_ERROR_TRACKING","APM_OPTIONS_ENDPOINT","APM_OPTIONS_HOSTNAME","APM_OPTIONS_PAYLOAD_TIMEOUT","APM_OPTIONS_PROXY","APM_OPTIONS_DOCUMENT_SIZE_CACHE_SIZE","_connectWithEnv","settings","packages","isDisabled","APM_APP_ID","APM_APP_SECRET"],"mappings":"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","file":"/packages/mdg_meteor-apm-agent.js","sourcesContent":["Kadira = {};\nKadira.options = {};\n\nif(Meteor.wrapAsync) {\n  Kadira._wrapAsync = Meteor.wrapAsync;\n} else {\n  Kadira._wrapAsync = Meteor._wrapAsync;\n}\n\nif(Meteor.isServer) {\n  var EventEmitter = Npm.require('events').EventEmitter;\n  var eventBus = new EventEmitter();\n  eventBus.setMaxListeners(0);\n\n  var buildArgs = function(args) {\n    args = _.toArray(args);\n    var eventName = args[0] + '-' + args[1];\n    var args = args.slice(2);\n    args.unshift(eventName);\n    return args;\n  };\n  \n  Kadira.EventBus = {};\n  ['on', 'emit', 'removeListener', 'removeAllListeners'].forEach(function(m) {\n    Kadira.EventBus[m] = function() {\n      var args = buildArgs(arguments);\n      return eventBus[m].apply(eventBus, args);\n    };\n  });\n}","var commonErrRegExps = [\n  /connection timeout\\. no (\\w*) heartbeat received/i,\n  /INVALID_STATE_ERR/i,\n];\n\nKadira.errorFilters = {\n  filterValidationErrors: function(type, message, err) {\n    if(err && err instanceof Meteor.Error) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  filterCommonMeteorErrors: function(type, message) {\n    for(var lc=0; lc<commonErrRegExps.length; lc++) {\n      var regExp = commonErrRegExps[lc];\n      if(regExp.test(message)) {\n        return false;\n      }\n    }\n    return true;\n  }\n};","Kadira.send = function (payload, path, callback) {\n  if(!Kadira.connected)  {\n    throw new Error(\"You need to connect with Kadira first, before sending messages!\");\n  }\n\n  path = (path.substr(0, 1) != '/')? \"/\" + path : path;\n  var endpoint = Kadira.options.endpoint + path;\n  var retryCount = 0;\n  var retry = new Retry({\n    minCount: 1,\n    minTimeout: 0,\n    baseTimeout: 1000*5,\n    maxTimeout: 1000*60,\n  });\n\n  var sendFunction = Kadira._getSendFunction();\n  tryToSend();\n\n  function tryToSend(err) {\n    if(retryCount < 5) {\n      retry.retryLater(retryCount++, send);\n    } else {\n      console.warn('Error sending error traces to Kadira server');\n      if(callback) callback(err);\n    }\n  }\n\n  function send() {\n    sendFunction(endpoint, payload, function(err, content, statusCode) {\n      if(err) {\n        tryToSend(err);\n      } else if(statusCode == 200){\n        if(callback) callback(null, content);\n      } else {\n        if(callback) callback(new Meteor.Error(statusCode, content));\n      }\n    });\n  }\n};\n\nKadira._getSendFunction = function() {\n  return (Meteor.isServer)? Kadira._serverSend : Kadira._clientSend;\n};\n\nKadira._clientSend = function (endpoint, payload, callback) {\n  httpRequest('POST', endpoint, {\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    content: JSON.stringify(payload)\n  }, callback);\n}\n\nKadira._serverSend = function (endpoint, payload, callback) {\n  callback = callback || function() {};\n  var Fiber = Npm.require('fibers');\n  new Fiber(function() {\n    var httpOptions = {\n      data: payload,\n      headers: Kadira.options.authHeaders\n    };\n\n    HTTP.call('POST', endpoint, httpOptions, function(err, res) {\n      if(res) {\n        var content = (res.statusCode == 200)? res.data : res.content;\n        callback(null, content, res.statusCode);\n      } else {\n        callback(err);\n      }\n    });\n  }).run();\n}\n","BaseErrorModel = function(options) {\n  this._filters = [];\n};\n\nBaseErrorModel.prototype.addFilter = function(filter) {\n  if(typeof filter === 'function') {\n    this._filters.push(filter);\n  } else {\n    throw new Error(\"Error filter must be a function\");\n  }\n};\n\nBaseErrorModel.prototype.removeFilter = function(filter) {\n  var index = this._filters.indexOf(filter);\n  if(index >= 0) {\n    this._filters.splice(index, 1);\n  }\n};\n\nBaseErrorModel.prototype.applyFilters = function(type, message, error, subType) {\n  for(var lc=0; lc<this._filters.length; lc++) {\n    var filter = this._filters[lc];\n    try {\n      var validated = filter(type, message, error, subType);\n      if(!validated) return false;\n    } catch (ex) {\n      // we need to remove this filter\n      // we may ended up in a error cycle\n      this._filters.splice(lc, 1);\n      throw new Error(\"an error thrown from a filter you've suplied\", ex.message);\n    }\n  }\n\n  return true;\n};","KadiraModel = function() {\n\n};\n\nKadiraModel.prototype._getDateId = function(timestamp) {\n  var remainder = timestamp % (1000 * 60);\n  var dateId = timestamp - remainder;\n  return dateId;\n};","var METHOD_METRICS_FIELDS = ['wait', 'db', 'http', 'email', 'async', 'compute', 'total'];\n\nMethodsModel = function (metricsThreshold) {\n  var self = this;\n\n  this.methodMetricsByMinute = Object.create(null);\n  this.errorMap = Object.create(null);\n\n  this._metricsThreshold = Object.assign({\n    \"wait\": 100,\n    \"db\": 100,\n    \"http\": 1000,\n    \"email\": 100,\n    \"async\": 100,\n    \"compute\": 100,\n    \"total\": 200\n  }, metricsThreshold || Object.create(null));\n\n  //store max time elapsed methods for each method, event(metrics-field)\n  this.maxEventTimesForMethods = Object.create(null);\n\n  this.tracerStore = new TracerStore({\n    interval: 1000 * 60, //process traces every minute\n    maxTotalPoints: 30, //for 30 minutes\n    archiveEvery: 5 //always trace for every 5 minutes,\n  });\n\n  this.tracerStore.start();\n};\n\nObject.assign(MethodsModel.prototype, KadiraModel.prototype);\n\nMethodsModel.prototype._getMetrics = function(timestamp, method) {\n  var dateId = this._getDateId(timestamp);\n\n  if(!this.methodMetricsByMinute[dateId]) {\n    this.methodMetricsByMinute[dateId] = {\n      methods: Object.create(null),\n    };\n  }\n\n  var methods = this.methodMetricsByMinute[dateId].methods;\n\n  //initialize method\n  if(!methods[method]) {\n    methods[method] = {\n      count: 0,\n      errors: 0,\n      fetchedDocSize: 0,\n      sentMsgSize: 0\n    };\n\n    METHOD_METRICS_FIELDS.forEach(function(field) {\n      methods[method][field] = 0;\n    });\n  }\n\n  return this.methodMetricsByMinute[dateId].methods[method];\n};\n\nMethodsModel.prototype.setStartTime = function(timestamp) {\n  this.metricsByMinute[dateId].startTime = timestamp;\n}\n\nMethodsModel.prototype.processMethod = function(methodTrace) {\n  var dateId = this._getDateId(methodTrace.at);\n\n  //append metrics to previous values\n  this._appendMetrics(dateId, methodTrace);\n  if(methodTrace.errored) {\n    this.methodMetricsByMinute[dateId].methods[methodTrace.name].errors ++\n  }\n\n  this.tracerStore.addTrace(methodTrace);\n};\n\nMethodsModel.prototype._appendMetrics = function(id, methodTrace) {\n  var methodMetrics = this._getMetrics(id, methodTrace.name)\n\n  // startTime needs to be converted into serverTime before sending\n  if(!this.methodMetricsByMinute[id].startTime){\n    this.methodMetricsByMinute[id].startTime = methodTrace.at;\n  }\n\n  //merge\n  METHOD_METRICS_FIELDS.forEach(function(field) {\n    var value = methodTrace.metrics[field];\n    if(value > 0) {\n      methodMetrics[field] += value;\n    }\n  });\n\n  methodMetrics.count++;\n  this.methodMetricsByMinute[id].endTime = methodTrace.metrics.at;\n};\n\nMethodsModel.prototype.trackDocSize = function(method, size) {\n  var timestamp = Ntp._now();\n  var dateId = this._getDateId(timestamp);\n\n  var methodMetrics = this._getMetrics(dateId, method);\n  methodMetrics.fetchedDocSize += size;\n}\n\nMethodsModel.prototype.trackMsgSize = function(method, size) {\n  var timestamp = Ntp._now();\n  var dateId = this._getDateId(timestamp);\n\n  var methodMetrics = this._getMetrics(dateId, method);\n  methodMetrics.sentMsgSize += size;\n}\n\n/*\n  There are two types of data\n\n  1. methodMetrics - metrics about the methods (for every 10 secs)\n  2. methodRequests - raw method request. normally max, min for every 1 min and errors always\n*/\nMethodsModel.prototype.buildPayload = function(buildDetailedInfo) {\n  var payload = {\n    methodMetrics: [],\n    methodRequests: []\n  };\n\n  //handling metrics\n  var methodMetricsByMinute = this.methodMetricsByMinute;\n  this.methodMetricsByMinute = Object.create(null);\n\n  //create final paylod for methodMetrics\n  for(var key in methodMetricsByMinute) {\n    var methodMetrics = methodMetricsByMinute[key];\n    // converting startTime into the actual serverTime\n    var startTime = methodMetrics.startTime;\n    methodMetrics.startTime = Kadira.syncedDate.syncTime(startTime);\n\n    for(var methodName in methodMetrics.methods) {\n      METHOD_METRICS_FIELDS.forEach(function(field) {\n        methodMetrics.methods[methodName][field] /=\n          methodMetrics.methods[methodName].count;\n      });\n    }\n\n    payload.methodMetrics.push(methodMetricsByMinute[key]);\n  }\n\n  //collect traces and send them with the payload\n  payload.methodRequests = this.tracerStore.collectTraces();\n\n  return payload;\n};\n","var logger = Npm.require('debug')('kadira:pubsub');\n\nimport { size, each, get } from \"../utils.js\";\n\nPubsubModel = function() {\n  this.metricsByMinute = Object.create(null);\n  this.subscriptions = Object.create(null);\n\n  this.tracerStore = new TracerStore({\n    interval: 1000 * 60, //process traces every minute\n    maxTotalPoints: 30, //for 30 minutes\n    archiveEvery: 5 //always trace for every 5 minutes,\n  });\n\n  this.tracerStore.start();\n}\n\nPubsubModel.prototype._trackSub = function(session, msg) {\n  logger('SUB:', session.id, msg.id, msg.name, msg.params);\n  var publication = this._getPublicationName(msg.name);\n  var subscriptionId = msg.id;\n  var timestamp = Ntp._now();\n  var metrics = this._getMetrics(timestamp, publication);\n\n  metrics.subs++;\n  this.subscriptions[msg.id] = {\n    // We use localTime here, because when we used synedTime we might get\n    // minus or more than we've expected\n    //   (before serverTime diff changed overtime)\n    startTime: timestamp,\n    publication: publication,\n    params: msg.params,\n    id: msg.id\n  };\n\n  //set session startedTime\n  session._startTime = session._startTime || timestamp;\n};\n\nObject.assign(PubsubModel.prototype, KadiraModel.prototype);\n\nPubsubModel.prototype._trackUnsub = function(session, sub) {\n  logger('UNSUB:', session.id, sub._subscriptionId);\n  var publication = this._getPublicationName(sub._name);\n  var subscriptionId = sub._subscriptionId;\n  var subscriptionState = this.subscriptions[subscriptionId];\n\n  var startTime = null;\n  //sometime, we don't have these states\n  if(subscriptionState) {\n    startTime = subscriptionState.startTime;\n  } else {\n    //if this is null subscription, which is started automatically\n    //hence, we don't have a state\n    startTime = session._startTime;\n  }\n\n  //in case, we can't get the startTime\n  if(startTime) {\n    var timestamp = Ntp._now();\n    var metrics = this._getMetrics(timestamp, publication);\n    //track the count\n    if(sub._name != null) {\n      // we can't track subs for `null` publications.\n      // so we should not track unsubs too\n      metrics.unsubs++;\n    }\n    //use the current date to get the lifeTime of the subscription\n    metrics.lifeTime += timestamp - startTime;\n    //this is place we can clean the subscriptionState if exists\n    delete this.subscriptions[subscriptionId];\n  }\n};\n\nPubsubModel.prototype._trackReady = function(session, sub, trace) {\n  logger('READY:', session.id, sub._subscriptionId);\n  //use the current time to track the response time\n  var publication = this._getPublicationName(sub._name);\n  var subscriptionId = sub._subscriptionId;\n  var timestamp = Ntp._now();\n  var metrics = this._getMetrics(timestamp, publication);\n\n  var subscriptionState = this.subscriptions[subscriptionId];\n  if(subscriptionState && !subscriptionState.readyTracked) {\n    metrics.resTime += timestamp - subscriptionState.startTime;\n    subscriptionState.readyTracked = true;\n  }\n\n  if(trace) {\n    this.tracerStore.addTrace(trace);\n  }\n};\n\nPubsubModel.prototype._trackError = function(session, sub, trace) {\n  logger('ERROR:', session.id, sub._subscriptionId);\n  //use the current time to track the response time\n  var publication = this._getPublicationName(sub._name);\n  var subscriptionId = sub._subscriptionId;\n  var timestamp = Ntp._now();\n  var metrics = this._getMetrics(timestamp, publication);\n\n  metrics.errors++;\n\n  if(trace) {\n    this.tracerStore.addTrace(trace);\n  }\n};\n\nPubsubModel.prototype._getMetrics = function(timestamp, publication) {\n  var dateId = this._getDateId(timestamp);\n\n  if(!this.metricsByMinute[dateId]) {\n    this.metricsByMinute[dateId] = {\n      // startTime needs to be convert to serverTime before sending to the server\n      startTime: timestamp,\n      pubs: Object.create(null)\n    };\n  }\n\n  if(!this.metricsByMinute[dateId].pubs[publication]) {\n    this.metricsByMinute[dateId].pubs[publication] = {\n      subs: 0,\n      unsubs: 0,\n      resTime: 0,\n      activeSubs: 0,\n      activeDocs: 0,\n      lifeTime: 0,\n      totalObservers: 0,\n      cachedObservers: 0,\n      createdObservers: 0,\n      deletedObservers: 0,\n      errors: 0,\n      observerLifetime: 0,\n      polledDocuments: 0,\n      oplogUpdatedDocuments: 0,\n      oplogInsertedDocuments: 0,\n      oplogDeletedDocuments: 0,\n      initiallyAddedDocuments: 0,\n      liveAddedDocuments: 0,\n      liveChangedDocuments: 0,\n      liveRemovedDocuments: 0,\n      polledDocSize: 0,\n      fetchedDocSize: 0,\n      initiallyFetchedDocSize: 0,\n      liveFetchedDocSize: 0,\n      initiallySentMsgSize: 0,\n      liveSentMsgSize: 0\n    };\n  }\n\n  return this.metricsByMinute[dateId].pubs[publication];\n};\n\nPubsubModel.prototype._getPublicationName = function(name) {\n  return name || \"null(autopublish)\";\n};\n\nPubsubModel.prototype._getSubscriptionInfo = function() {\n  var self = this;\n  var activeSubs = Object.create(null);\n  var activeDocs = Object.create(null);\n  var totalDocsSent = Object.create(null);\n  var totalDataSent = Object.create(null);\n  var totalObservers = Object.create(null);\n  var cachedObservers = Object.create(null);\n\n  each(Meteor.server.sessions, session => {\n    each(session._namedSubs, countSubData);\n    each(session._universalSubs, countSubData);\n  });\n\n  var avgObserverReuse = Object.create(null);\n  _.each(totalObservers, function(value, publication) {\n    avgObserverReuse[publication] = cachedObservers[publication] / totalObservers[publication];\n  });\n\n  return {\n    activeSubs: activeSubs,\n    activeDocs: activeDocs,\n    avgObserverReuse: avgObserverReuse\n  };\n\n  function countSubData (sub) {\n    var publication = self._getPublicationName(sub._name);\n    countSubscriptions(sub, publication);\n    countDocuments(sub, publication);\n    countObservers(sub, publication);\n  }\n\n  function countSubscriptions (sub, publication) {\n    activeSubs[publication] = activeSubs[publication] || 0;\n    activeSubs[publication]++;\n  }\n\n  function countDocuments (sub, publication) {\n    activeDocs[publication] = activeDocs[publication] || 0;\n    each(sub._documents, document => {\n      activeDocs[publication] += size(document);\n    });\n  }\n\n  function countObservers(sub, publication) {\n    totalObservers[publication] = totalObservers[publication] || 0;\n    cachedObservers[publication] = cachedObservers[publication] || 0;\n\n    totalObservers[publication] += sub._totalObservers;\n    cachedObservers[publication] += sub._cachedObservers;\n  }\n}\n\nPubsubModel.prototype.buildPayload = function(buildDetailInfo) {\n  var metricsByMinute = this.metricsByMinute;\n  this.metricsByMinute = Object.create(null);\n\n  var payload = {\n    pubMetrics: []\n  };\n\n  var subscriptionData = this._getSubscriptionInfo();\n  var activeSubs = subscriptionData.activeSubs;\n  var activeDocs = subscriptionData.activeDocs;\n  var avgObserverReuse = subscriptionData.avgObserverReuse;\n\n  //to the averaging\n  for(var dateId in metricsByMinute) {\n    var dateMetrics = metricsByMinute[dateId];\n    // We need to convert startTime into actual serverTime\n    dateMetrics.startTime = Kadira.syncedDate.syncTime(dateMetrics.startTime);\n\n    for(var publication in metricsByMinute[dateId].pubs) {\n      var singlePubMetrics = metricsByMinute[dateId].pubs[publication];\n      // We only calculate resTime for new subscriptions\n      singlePubMetrics.resTime /= singlePubMetrics.subs;\n      singlePubMetrics.resTime = singlePubMetrics.resTime || 0;\n      // We only track lifeTime in the unsubs\n      singlePubMetrics.lifeTime /= singlePubMetrics.unsubs;\n      singlePubMetrics.lifeTime = singlePubMetrics.lifeTime || 0;\n\n      // Count the average for observer lifetime\n      if(singlePubMetrics.deletedObservers > 0) {\n        singlePubMetrics.observerLifetime /= singlePubMetrics.deletedObservers;\n      }\n\n      // If there are two ore more dateIds, we will be using the currentCount for all of them.\n      // We can come up with a better solution later on.\n      singlePubMetrics.activeSubs = activeSubs[publication] || 0;\n      singlePubMetrics.activeDocs = activeDocs[publication] || 0;\n      singlePubMetrics.avgObserverReuse = avgObserverReuse[publication] || 0;\n    }\n\n    payload.pubMetrics.push(metricsByMinute[dateId]);\n  }\n\n  //collect traces and send them with the payload\n  payload.pubRequests = this.tracerStore.collectTraces();\n\n  return payload;\n};\n\nPubsubModel.prototype.incrementHandleCount = function(trace, isCached) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(trace.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  var session = get(Meteor.server.sessions, trace.session);\n  if (session) {\n    var sub = get(session._namedSubs, trace.id);\n    if (sub) {\n      sub._totalObservers = sub._totalObservers || 0;\n      sub._cachedObservers = sub._cachedObservers || 0;\n    }\n  }\n  // not sure, we need to do this? But I don't need to break the however\n  sub = sub || {_totalObservers:0 , _cachedObservers: 0};\n\n  publication.totalObservers++;\n  sub._totalObservers++;\n  if(isCached) {\n    publication.cachedObservers++;\n    sub._cachedObservers++;\n  }\n}\n\nPubsubModel.prototype.trackCreatedObserver = function(info) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  publication.createdObservers++;\n}\n\nPubsubModel.prototype.trackDeletedObserver = function(info) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  publication.deletedObservers++;\n  publication.observerLifetime += (new Date()).getTime() - info.startTime;\n}\n\nPubsubModel.prototype.trackDocumentChanges = function(info, op) {\n  // It's possibel that info to be null\n  // Specially when getting changes at the very begining.\n  // This may be false, but nice to have a check\n  if(!info) {\n    return\n  }\n\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  if(op.op === \"d\") {\n    publication.oplogDeletedDocuments++;\n  } else if(op.op === \"i\") {\n    publication.oplogInsertedDocuments++;\n  } else if(op.op === \"u\") {\n    publication.oplogUpdatedDocuments++;\n  }\n}\n\nPubsubModel.prototype.trackPolledDocuments = function(info, count) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  publication.polledDocuments += count;\n}\n\nPubsubModel.prototype.trackLiveUpdates = function(info, type, count) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  if(type === \"_addPublished\") {\n    publication.liveAddedDocuments += count;\n  } else if(type === \"_removePublished\") {\n    publication.liveRemovedDocuments += count;\n  } else if(type === \"_changePublished\") {\n    publication.liveChangedDocuments += count;\n  } else if(type === \"_initialAdds\") {\n    publication.initiallyAddedDocuments += count;\n  } else {\n    throw new Error(\"Kadira: Unknown live update type\");\n  }\n}\n\nPubsubModel.prototype.trackDocSize = function(name, type, size) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  if(type === \"polledFetches\") {\n    publication.polledDocSize += size;\n  } else if(type === \"liveFetches\") {\n    publication.liveFetchedDocSize += size;\n  } else if(type === \"cursorFetches\") {\n    publication.fetchedDocSize += size;\n  } else if(type === \"initialFetches\") {\n    publication.initiallyFetchedDocSize += size;\n  } else {\n    throw new Error(\"Kadira: Unknown docs fetched type\");\n  }\n}\n\nPubsubModel.prototype.trackMsgSize = function(name, type, size) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  if(type === \"liveSent\") {\n    publication.liveSentMsgSize += size;\n  } else if(type === \"initialSent\") {\n    publication.initiallySentMsgSize += size;\n  } else {\n    throw new Error(\"Kadira: Unknown docs fetched type\");\n  }\n}\n","import { size } from \"../utils.js\";\n\nvar os = Npm.require('os');\nvar usage = Npm.require('pidusage');\nvar EventLoopMonitor = Npm.require('evloop-monitor');\n\nSystemModel = function () {\n  var self = this;\n  this.startTime = Ntp._now();\n  this.newSessions = 0;\n  this.sessionTimeout = 1000 * 60 * 30; //30 min\n\n  this.usageLookup = Kadira._wrapAsync(usage.stat.bind(usage));\n  this.evloopMonitor = new EventLoopMonitor(200);\n  this.evloopMonitor.start();\n}\n\nObject.assign(SystemModel.prototype, KadiraModel.prototype);\n\nSystemModel.prototype.buildPayload = function() {\n  var metrics = {};\n  var now = Ntp._now();\n  metrics.startTime = Kadira.syncedDate.syncTime(this.startTime);\n  metrics.endTime = Kadira.syncedDate.syncTime(now);\n\n  metrics.sessions = size(Meteor.server.sessions);\n  metrics.memory = process.memoryUsage().rss / (1024*1024);\n  metrics.newSessions = this.newSessions;\n  this.newSessions = 0;\n\n  var usage = this.getUsage();\n  metrics.pcpu = usage.cpu;\n  if(usage.cpuInfo) {\n    metrics.cputime = usage.cpuInfo.cpuTime;\n    metrics.pcpuUser = usage.cpuInfo.pcpuUser;\n    metrics.pcpuSystem = usage.cpuInfo.pcpuSystem;\n  }\n\n  // track eventloop blockness\n  metrics.pctEvloopBlock = this.evloopMonitor.status().pctBlock;\n\n  this.startTime = now;\n  return {systemMetrics: [metrics]};\n};\n\nSystemModel.prototype.getUsage = function() {\n  var usage = this.usageLookup(process.pid) || {};\n  Kadira.docSzCache.setPcpu(usage.cpu);\n  return usage;\n};\n\nSystemModel.prototype.handleSessionActivity = function(msg, session) {\n  if(msg.msg === 'connect' && !msg.session) {\n    this.countNewSession(session);\n  } else if(['sub', 'method'].indexOf(msg.msg) != -1) {\n    if(!this.isSessionActive(session)) {\n      this.countNewSession(session);\n    }\n  }\n  session._activeAt = Date.now();\n}\n\nSystemModel.prototype.countNewSession = function(session) {\n  if(!isLocalAddress(session.socket)) {\n    this.newSessions++;\n  }\n}\n\nSystemModel.prototype.isSessionActive = function(session) {\n  var inactiveTime = Date.now() - session._activeAt;\n  return inactiveTime < this.sessionTimeout;\n}\n\n// ------------------------------------------------------------------------- //\n\n// http://regex101.com/r/iF3yR3/2\nvar isLocalHostRegex = /^(?:.*\\.local|localhost)(?:\\:\\d+)?|127(?:\\.\\d{1,3}){3}|192\\.168(?:\\.\\d{1,3}){2}|10(?:\\.\\d{1,3}){3}|172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2}$/;\n\n// http://regex101.com/r/hM5gD8/1\nvar isLocalAddressRegex = /^127(?:\\.\\d{1,3}){3}|192\\.168(?:\\.\\d{1,3}){2}|10(?:\\.\\d{1,3}){3}|172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2}$/;\n\nfunction isLocalAddress (socket) {\n  var host = socket.headers['host'];\n  if(host) return isLocalHostRegex.test(host);\n  var address = socket.headers['x-forwarded-for'] || socket.remoteAddress;\n  if(address) return isLocalAddressRegex.test(address);\n}\n","ErrorModel = function (appId) {\n  BaseErrorModel.call(this);\n  var self = this;\n  this.appId = appId;\n  this.errors = {};\n  this.startTime = Date.now();\n  this.maxErrors = 10;\n}\n\nObject.assign(ErrorModel.prototype, KadiraModel.prototype);\nObject.assign(ErrorModel.prototype, BaseErrorModel.prototype);\n\nErrorModel.prototype.buildPayload = function() {\n  var metrics = _.values(this.errors);\n  this.startTime = Ntp._now();\n\n  _.each(metrics, function (metric) {\n    metric.startTime = Kadira.syncedDate.syncTime(metric.startTime)\n  });\n\n  this.errors = {};\n  return {errors: metrics};\n};\n\nErrorModel.prototype.errorCount = function () {\n  return _.values(this.errors).length;\n};\n\nErrorModel.prototype.trackError = function(ex, trace) {\n  var key = trace.type + ':' + ex.message;\n  if(this.errors[key]) {\n    this.errors[key].count++;\n  } else if (this.errorCount() < this.maxErrors) {\n    var errorDef = this._formatError(ex, trace);\n    if(this.applyFilters(errorDef.type, errorDef.name, ex, errorDef.subType)) {\n      this.errors[key] = this._formatError(ex, trace);\n    }\n  }\n};\n\nErrorModel.prototype._formatError = function(ex, trace) {\n  var time = Date.now();\n  var stack = ex.stack;\n\n  // to get Meteor's Error details\n  if(ex.details) {\n    stack = \"Details: \" + ex.details + \"\\r\\n\" + stack;\n  }\n\n  // Update trace's error event with the next stack\n  var errorEvent = trace.events && trace.events[trace.events.length -1];\n  var errorObject = errorEvent && errorEvent[2] && errorEvent[2].error;\n\n  if(errorObject) {\n    errorObject.stack = stack;\n  }\n\n  return {\n    appId: this.appId,\n    name: ex.message,\n    type: trace.type,\n    startTime: time,\n    subType: trace.subType || trace.name,\n    trace: trace,\n    stacks: [{stack: stack}],\n    count: 1,\n  }\n};\n","var Jobs = Kadira.Jobs = {};\n\nJobs.getAsync = function(id, callback) {\n  Kadira.coreApi.getJob(id)\n    .then(function(data) {\n      callback(null, data);\n    })\n    .catch(function(err) {\n      callback(err)\n    });\n};\n\n\nJobs.setAsync = function(id, changes, callback) {\n  Kadira.coreApi.updateJob(id, changes)\n    .then(function(data) {\n      callback(null, data);\n    })\n    .catch(function(err) {\n      callback(err)\n    });\n};\n\nJobs.set = Kadira._wrapAsync(Jobs.setAsync);\nJobs.get = Kadira._wrapAsync(Jobs.getAsync);\n","// Retry logic with an exponential backoff.\n//\n// options:\n//  baseTimeout: time for initial reconnect attempt (ms).\n//  exponent: exponential factor to increase timeout each attempt.\n//  maxTimeout: maximum time between retries (ms).\n//  minCount: how many times to reconnect \"instantly\".\n//  minTimeout: time to wait for the first `minCount` retries (ms).\n//  fuzz: factor to randomize retry times by (to avoid retry storms).\n\n//TODO: remove this class and use Meteor Retry in a later version of meteor.\n\nRetry = function (options) {\n  var self = this;\n  Object.assign(self, _.defaults(_.clone(options || {}), {\n    baseTimeout: 1000, // 1 second\n    exponent: 2.2,\n    // The default is high-ish to ensure a server can recover from a\n    // failure caused by load.\n    maxTimeout: 5 * 60000, // 5 minutes\n    minTimeout: 10,\n    minCount: 2,\n    fuzz: 0.5 // +- 25%\n  }));\n  self.retryTimer = null;\n};\n\nObject.assign(Retry.prototype, {\n\n  // Reset a pending retry, if any.\n  clear: function () {\n    var self = this;\n    if(self.retryTimer)\n      clearTimeout(self.retryTimer);\n    self.retryTimer = null;\n  },\n\n  // Calculate how long to wait in milliseconds to retry, based on the\n  // `count` of which retry this is.\n  _timeout: function (count) {\n    var self = this;\n\n    if(count < self.minCount)\n      return self.minTimeout;\n\n    var timeout = Math.min(\n      self.maxTimeout,\n      self.baseTimeout * Math.pow(self.exponent, count));\n    // fuzz the timeout randomly, to avoid reconnect storms when a\n    // server goes down.\n    timeout = timeout * ((Random.fraction() * self.fuzz) +\n                         (1 - self.fuzz/2));\n    return Math.ceil(timeout);\n  },\n\n  // Call `fn` after a delay, based on the `count` of which retry this is.\n  retryLater: function (count, fn) {\n    var self = this;\n    var timeout = self._timeout(count);\n    if(self.retryTimer)\n      clearTimeout(self.retryTimer);\n\n    self.retryTimer = setTimeout(fn, timeout);\n    return timeout;\n  }\n\n});\n","var Fiber = Npm.require('fibers');\n\nexport function size(collection) {\n  if (collection instanceof Map ||\n      collection instanceof Set) {\n    return collection.size;\n  }\n  return _.size(collection);\n}\n\nexport function each(collection, callback) {\n  if (collection instanceof Map ||\n      collection instanceof Set) {\n    collection.forEach(callback);\n  } else {\n    _.each(collection, callback);\n  }\n}\n\nexport function get(collection, key) {\n  if (collection instanceof Map) {\n    return collection.get(key);\n  }\n  return collection[key];\n}\n\nHaveAsyncCallback = function(args) {\n  var lastArg = args[args.length -1];\n  return (typeof lastArg) == 'function';\n};\n\nUniqueId = function(start) {\n  this.id = 0;\n}\n\nUniqueId.prototype.get = function() {\n  return \"\" + this.id++;\n};\n\nDefaultUniqueId = new UniqueId();\n\n// Optimized version of apply which tries to call as possible as it can\n// Then fall back to apply\n// This is because, v8 is very slow to invoke apply.\nOptimizedApply = function OptimizedApply(context, fn, args) {\n  var a = args;\n  switch(a.length) {\n    case 0:\n      return fn.call(context);\n    case 1:\n      return fn.call(context, a[0]);\n    case 2:\n      return fn.call(context, a[0], a[1]);\n    case 3:\n      return fn.call(context, a[0], a[1], a[2]);\n    case 4:\n      return fn.call(context, a[0], a[1], a[2], a[3]);\n    case 5:\n      return fn.call(context, a[0], a[1], a[2], a[3], a[4]);\n    default:\n      return fn.apply(context, a);\n  }\n}\n","var logger = getLogger();\n\nNtp = function (endpoint) {\n  this.setEndpoint(endpoint);\n  this.diff = 0;\n  this.synced = false;\n  this.reSyncCount = 0;\n  this.reSync = new Retry({\n    baseTimeout: 1000*60,\n    maxTimeout: 1000*60*10,\n    minCount: 0\n  });\n}\n\nNtp._now = function() {\n  var now = Date.now();\n  if(typeof now == 'number') {\n    return now;\n  } else if(now instanceof Date) {\n    // some extenal JS libraries override Date.now and returns a Date object\n    // which directly affect us. So we need to prepare for that\n    return now.getTime();\n  } else {\n    // trust me. I've seen now === undefined\n    return (new Date()).getTime();\n  }\n};\n\nNtp.prototype.setEndpoint = function(endpoint) {\n  this.endpoint = endpoint + '/simplentp/sync';\n};\n\nNtp.prototype.getTime = function() {\n  return Ntp._now() + Math.round(this.diff);\n};\n\nNtp.prototype.syncTime = function(localTime) {\n  return localTime + Math.ceil(this.diff);\n};\n\nNtp.prototype.sync = function() {\n  logger('init sync');\n  var self = this;\n  var retryCount = 0;\n  var retry = new Retry({\n    baseTimeout: 1000*20,\n    maxTimeout: 1000*60,\n    minCount: 1,\n    minTimeout: 0\n  });\n  syncTime();\n\n  function syncTime () {\n    if(retryCount<5) {\n      logger('attempt time sync with server', retryCount);\n      // if we send 0 to the retryLater, cacheDns will run immediately\n      retry.retryLater(retryCount++, cacheDns);\n    } else {\n      logger('maximum retries reached');\n      self.reSync.retryLater(self.reSyncCount++, function () {\n        var args = [].slice.call(arguments);\n        self.sync.apply(self, args);\n      });\n    }\n  }\n\n  // first attempt is to cache dns. So, calculation does not\n  // include DNS resolution time\n  function cacheDns () {\n    self.getServerTime(function(err) {\n      if(!err) {\n        calculateTimeDiff();\n      } else {\n        syncTime();\n      }\n    });\n  }\n\n  function calculateTimeDiff () {\n    var clientStartTime = (new Date()).getTime();\n    self.getServerTime(function(err, serverTime) {\n      if(!err && serverTime) {\n        // (Date.now() + clientStartTime)/2 : Midpoint between req and res\n        var networkTime = ((new Date()).getTime() - clientStartTime)/2\n        var serverStartTime = serverTime - networkTime;\n        self.diff = serverStartTime - clientStartTime;\n        self.synced = true;\n        // we need to send 1 into retryLater.\n        self.reSync.retryLater(self.reSyncCount++, function () {\n          var args = [].slice.call(arguments);\n          self.sync.apply(self, args);\n        });\n        logger('successfully updated diff value', self.diff);\n      } else {\n        syncTime();\n      }\n    });\n  }\n}\n\nNtp.prototype.getServerTime = function(callback) {\n  var self = this;\n\n  if(Meteor.isServer) {\n    var Fiber = Npm.require('fibers');\n    new Fiber(function() {\n      HTTP.get(self.endpoint, function (err, res) {\n        if(err) {\n          callback(err);\n        } else {\n          var serverTime = parseInt(res.content);\n          callback(null, serverTime);\n        }\n      });\n    }).run();\n  } else {\n    httpRequest('GET', self.endpoint, function(err, res) {\n      if (err) {\n        callback(err);\n      } else {\n        var serverTime = parseInt(res.content);\n        callback(null, serverTime);\n      }\n    });\n  }\n};\n\nfunction getLogger() {\n  if(Meteor.isServer) {\n    return Npm.require('debug')(\"kadira:ntp\");\n  } else {\n    return function(message) {\n      var canLogKadira =\n        Meteor._localStorage.getItem('LOG_KADIRA') !== null\n        && typeof console !== 'undefined';\n\n      if(canLogKadira) {\n        if(message) {\n          message = \"kadira:ntp \" + message;\n          arguments[0] = message;\n        }\n        console.log.apply(console, arguments);\n      }\n    }\n  }\n}\n","var WAITON_MESSAGE_FIELDS = ['msg', 'id', 'method', 'name', 'waitTime'];\n\n// This is way how we can build waitTime and it's breakdown\nWaitTimeBuilder = function() {\n  this._waitListStore = {};\n  this._currentProcessingMessages = {};\n  this._messageCache = {};\n};\n\nWaitTimeBuilder.prototype.register = function(session, msgId) {\n  var self = this;\n  var mainKey = self._getMessageKey(session.id, msgId);\n\n  var inQueue = session.inQueue || [];\n  if(typeof inQueue.toArray === 'function') {\n    // latest version of Meteor uses a double-ended-queue for the inQueue\n    // info: https://www.npmjs.com/package/double-ended-queue\n    inQueue = inQueue.toArray();\n  }\n\n  var waitList = inQueue.map(function(msg) {\n    var key = self._getMessageKey(session.id, msg.id);\n    return self._getCacheMessage(key, msg);\n  });\n\n  waitList = waitList || [];\n\n  //add currently processing ddp message if exists\n  var currentlyProcessingMessage = this._currentProcessingMessages[session.id];\n  if(currentlyProcessingMessage) {\n    var key = self._getMessageKey(session.id, currentlyProcessingMessage.id);\n    waitList.unshift(this._getCacheMessage(key, currentlyProcessingMessage));\n  }\n\n  this._waitListStore[mainKey] = waitList;\n};\n\nWaitTimeBuilder.prototype.build = function(session, msgId) {\n  var mainKey = this._getMessageKey(session.id, msgId);\n  var waitList = this._waitListStore[mainKey] || [];\n  delete this._waitListStore[mainKey];\n\n  var filteredWaitList =  waitList.map(this._cleanCacheMessage.bind(this));\n  return filteredWaitList;\n};\n\nWaitTimeBuilder.prototype._getMessageKey = function(sessionId, msgId) {\n  return sessionId + \"::\" + msgId;\n};\n\nWaitTimeBuilder.prototype._getCacheMessage = function(key, msg) {\n  var self = this;\n  var cachedMessage = self._messageCache[key];\n  if(!cachedMessage) {\n    self._messageCache[key] = cachedMessage = _.pick(msg, WAITON_MESSAGE_FIELDS);\n    cachedMessage._key = key;\n    cachedMessage._registered = 1;\n  } else {\n    cachedMessage._registered++;\n  }\n\n  return cachedMessage;\n};\n\nWaitTimeBuilder.prototype._cleanCacheMessage = function(msg) {\n  msg._registered--;\n  if(msg._registered == 0) {\n    delete this._messageCache[msg._key];\n  }\n\n  // need to send a clean set of objects\n  // otherwise register can go with this\n  return _.pick(msg, WAITON_MESSAGE_FIELDS);\n};\n\nWaitTimeBuilder.prototype.trackWaitTime = function(session, msg, unblock) {\n  var self = this;\n  var started = Date.now();\n  self._currentProcessingMessages[session.id] = msg;\n\n  var unblocked = false;\n  var wrappedUnblock = function() {\n    if(!unblocked) {\n      var waitTime = Date.now() - started;\n      var key = self._getMessageKey(session.id, msg.id);\n      var cachedMessage = self._messageCache[key];\n      if(cachedMessage) {\n        cachedMessage.waitTime = waitTime;\n      }\n      delete self._currentProcessingMessages[session.id];\n      unblocked = true;\n      unblock();\n    }\n  };\n\n  return wrappedUnblock;\n};","// expose for testing purpose\nOplogCheck = {};\n\nOplogCheck._070 = function(cursorDescription) {\n  var options = cursorDescription.options;\n  if (options.limit) {\n    return {\n      code: \"070_LIMIT_NOT_SUPPORTED\",\n      reason: \"Meteor 0.7.0 does not support limit with oplog.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  };\n\n  var exists$ = _.any(cursorDescription.selector, function (value, field) {\n    if (field.substr(0, 1) === '$')\n      return true;\n  });\n\n  if(exists$) {\n    return {\n      code: \"070_$_NOT_SUPPORTED\",\n      reason: \"Meteor 0.7.0 supports only equal checks with oplog.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  };\n\n  var onlyScalers = _.all(cursorDescription.selector, function (value, field) {\n    return typeof value === \"string\" ||\n      typeof value === \"number\" ||\n      typeof value === \"boolean\" ||\n      value === null ||\n      value instanceof Meteor.Collection.ObjectID;\n  });\n\n  if(!onlyScalers) {\n    return {\n      code: \"070_ONLY_SCALERS\",\n      reason: \"Meteor 0.7.0 only supports scalers as comparators.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  }\n\n  return true;\n};\n\nOplogCheck._071 = function(cursorDescription) {\n  var options = cursorDescription.options;\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n  if (options.limit) {\n    return {\n      code: \"071_LIMIT_NOT_SUPPORTED\",\n      reason: \"Meteor 0.7.1 does not support limit with oplog.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  };\n\n  return true;\n};\n\n\nOplogCheck.env = function() {\n  if(!process.env.MONGO_OPLOG_URL) {\n    return {\n      code: \"NO_ENV\",\n      reason: \"You haven't added oplog support for your the Meteor app.\",\n      solution: \"Add oplog support for your Meteor app. see: http://goo.gl/Co1jJc\"\n    }\n  } else {\n    return true;\n  }\n};\n\nOplogCheck.disableOplog = function(cursorDescription) {\n  if(cursorDescription.options._disableOplog) {\n    return {\n      code: \"DISABLE_OPLOG\",\n      reason: \"You've disable oplog for this cursor explicitly with _disableOplog option.\"\n    };\n  } else {\n    return true;\n  }\n};\n\n// when creating Minimongo.Matcher object, if that's throws an exception\n// meteor won't do the oplog support\nOplogCheck.miniMongoMatcher = function(cursorDescription) {\n  if(Minimongo.Matcher) {\n    try {\n      var matcher = new Minimongo.Matcher(cursorDescription.selector);\n      return true;\n    } catch(ex) {\n      return {\n        code: \"MINIMONGO_MATCHER_ERROR\",\n        reason: \"There's something wrong in your mongo query: \" +  ex.message,\n        solution: \"Check your selector and change it accordingly.\"\n      };\n    }\n  } else {\n    // If there is no Minimongo.Matcher, we don't need to check this\n    return true;\n  }\n};\n\nOplogCheck.miniMongoSorter = function(cursorDescription) {\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n  if(Minimongo.Sorter && cursorDescription.options.sort) {\n    try {\n      var sorter = new Minimongo.Sorter(\n        cursorDescription.options.sort,\n        { matcher: matcher }\n      );\n      return true;\n    } catch(ex) {\n      return {\n        code: \"MINIMONGO_SORTER_ERROR\",\n        reason: \"Some of your sort specifiers are not supported: \" + ex.message,\n        solution: \"Check your sort specifiers and chage them accordingly.\"\n      }\n    }\n  } else {\n    return true;\n  }\n};\n\nOplogCheck.fields = function(cursorDescription) {\n  var options = cursorDescription.options;\n  if(options.fields) {\n    try {\n      LocalCollection._checkSupportedProjection(options.fields);\n      return true;\n    } catch (e) {\n      if (e.name === \"MinimongoError\") {\n        return {\n          code: \"NOT_SUPPORTED_FIELDS\",\n          reason: \"Some of the field filters are not supported: \" + e.message,\n          solution: \"Try removing those field filters.\"\n        };\n      } else {\n        throw e;\n      }\n    }\n  }\n  return true;\n};\n\nOplogCheck.skip = function(cursorDescription) {\n  if(cursorDescription.options.skip) {\n    return {\n      code: \"SKIP_NOT_SUPPORTED\",\n      reason: \"Skip does not support with oplog.\",\n      solution: \"Try to avoid using skip. Use range queries instead: http://goo.gl/b522Av\"\n    };\n  }\n\n  return true;\n};\n\nOplogCheck.where = function(cursorDescription) {\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n  if(matcher.hasWhere()) {\n    return {\n      code: \"WHERE_NOT_SUPPORTED\",\n      reason: \"Meteor does not support queries with $where.\",\n      solution: \"Try to remove $where from your query. Use some alternative.\"\n    }\n  };\n\n  return true;\n};\n\nOplogCheck.geo = function(cursorDescription) {\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n\n  if(matcher.hasGeoQuery()) {\n    return {\n      code: \"GEO_NOT_SUPPORTED\",\n      reason: \"Meteor does not support queries with geo partial operators.\",\n      solution: \"Try to remove geo partial operators from your query if possible.\"\n    }\n  };\n\n  return true;\n};\n\nOplogCheck.limitButNoSort = function(cursorDescription) {\n  var options = cursorDescription.options;\n\n  if((options.limit && !options.sort)) {\n    return {\n      code: \"LIMIT_NO_SORT\",\n      reason: \"Meteor oplog implementation does not support limit without a sort specifier.\",\n      solution: \"Try adding a sort specifier.\"\n    }\n  };\n\n  return true;\n};\n\nOplogCheck.olderVersion = function(cursorDescription, driver) {\n  if(driver && !driver.constructor.cursorSupported) {\n    return {\n      code: \"OLDER_VERSION\",\n      reason: \"Your Meteor version does not have oplog support.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    };\n  }\n  return true;\n};\n\nOplogCheck.gitCheckout = function(cursorDescription, driver) {\n  if(!Meteor.release) {\n    return {\n      code: \"GIT_CHECKOUT\",\n      reason: \"Seems like your Meteor version is based on a Git checkout and it doesn't have the oplog support.\",\n      solution: \"Try to upgrade your Meteor version.\"\n    };\n  }\n  return true;\n};\n\nvar preRunningMatchers = [\n  OplogCheck.env,\n  OplogCheck.disableOplog,\n  OplogCheck.miniMongoMatcher\n];\n\nvar globalMatchers = [\n  OplogCheck.fields,\n  OplogCheck.skip,\n  OplogCheck.where,\n  OplogCheck.geo,\n  OplogCheck.limitButNoSort,\n  OplogCheck.miniMongoSorter,\n  OplogCheck.olderVersion,\n  OplogCheck.gitCheckout\n];\n\nvar versionMatchers = [\n  [/^0\\.7\\.1/, OplogCheck._071],\n  [/^0\\.7\\.0/, OplogCheck._070],\n];\n\nKadira.checkWhyNoOplog = function(cursorDescription, observerDriver) {\n  if(typeof Minimongo == 'undefined') {\n    return {\n      code: \"CANNOT_DETECT\",\n      reason: \"You are running an older Meteor version and Kadira can't check oplog state.\",\n      solution: \"Try updating your Meteor app\"\n    }\n  }\n\n  var result = runMatchers(preRunningMatchers, cursorDescription, observerDriver);\n  if(result !== true) {\n    return result;\n  }\n\n  var meteorVersion = Meteor.release;\n  for(var lc=0; lc<versionMatchers.length; lc++) {\n    var matcherInfo = versionMatchers[lc];\n    if(matcherInfo[0].test(meteorVersion)) {\n      var matched = matcherInfo[1](cursorDescription, observerDriver);\n      if(matched !== true) {\n        return matched;\n      }\n    }\n  }\n\n  result = runMatchers(globalMatchers, cursorDescription, observerDriver);\n  if(result !== true) {\n    return result;\n  }\n\n  return {\n    code: \"OPLOG_SUPPORTED\",\n    reason: \"This query should support oplog. It's weird if it's not.\",\n    solution: \"Please contact Kadira support and let's discuss.\"\n  };\n};\n\nfunction runMatchers(matcherList, cursorDescription, observerDriver) {\n  for(var lc=0; lc<matcherList.length; lc++) {\n    var matcher = matcherList[lc];\n    var matched = matcher(cursorDescription, observerDriver);\n    if(matched !== true) {\n      return matched;\n    }\n  }\n  return true;\n}\n","var Fibers = Npm.require('fibers');\nvar eventLogger = Npm.require('debug')('kadira:tracer');\nvar REPITITIVE_EVENTS = {'db': true, 'http': true, 'email': true, 'wait': true, 'async': true};\n\nTracer = function Tracer() {\n  this._filters = [];\n};\n\n//In the future, we might wan't to track inner fiber events too.\n//Then we can't serialize the object with methods\n//That's why we use this method of returning the data\nTracer.prototype.start = function(session, msg) {\n  var traceInfo = {\n    _id: session.id + \"::\" + msg.id,\n    session: session.id,\n    userId: session.userId,\n    id: msg.id,\n    events: []\n  };\n\n  if(msg.msg == 'method') {\n    traceInfo.type = 'method';\n    traceInfo.name = msg.method;\n  } else if(msg.msg == 'sub') {\n    traceInfo.type = 'sub';\n    traceInfo.name = msg.name;\n  } else {\n    return null;\n  }\n\n  return traceInfo;\n};\n\nTracer.prototype.event = function(traceInfo, type, data) {\n  // do not allow to proceed, if already completed or errored\n  var lastEvent = this.getLastEvent(traceInfo);\n  if(lastEvent && ['complete', 'error'].indexOf(lastEvent.type) >= 0) {\n    return false;\n  }\n\n  //expecting a end event\n  var eventId = true;\n\n  //specially handling for repitivive events like db, http\n  if(REPITITIVE_EVENTS[type]) {\n    //can't accept a new start event\n    if(traceInfo._lastEventId) {\n      return false;\n    }\n    eventId = traceInfo._lastEventId = DefaultUniqueId.get();\n  }\n\n  var event = {type: type, at: Ntp._now()};\n  if(data) {\n    var info = _.pick(traceInfo, 'type', 'name')\n    event.data = this._applyFilters(type, data, info, \"start\");;\n  }\n\n  traceInfo.events.push(event);\n\n  eventLogger(\"%s %s\", type, traceInfo._id);\n  return eventId;\n};\n\nTracer.prototype.eventEnd = function(traceInfo, eventId, data) {\n  if(traceInfo._lastEventId && traceInfo._lastEventId == eventId) {\n    var lastEvent = this.getLastEvent(traceInfo);\n    var type = lastEvent.type + 'end';\n    var event = {type: type, at: Ntp._now()};\n    if(data) {\n      var info = _.pick(traceInfo, 'type', 'name')\n      event.data = this._applyFilters(type, data, info, \"end\");;\n    }\n    traceInfo.events.push(event);\n    eventLogger(\"%s %s\", type, traceInfo._id);\n\n    traceInfo._lastEventId = null;\n    return true;\n  } else {\n    return false;\n  }\n};\n\nTracer.prototype.getLastEvent = function(traceInfo) {\n  return traceInfo.events[traceInfo.events.length -1]\n};\n\nTracer.prototype.endLastEvent = function(traceInfo) {\n  var lastEvent = this.getLastEvent(traceInfo);\n  if(lastEvent && !/end$/.test(lastEvent.type)) {\n    traceInfo.events.push({\n      type: lastEvent.type + 'end',\n      at: Ntp._now()\n    });\n    return true;\n  }\n  return false;\n};\n\nTracer.prototype.buildTrace = function(traceInfo) {\n  var firstEvent = traceInfo.events[0];\n  var lastEvent = traceInfo.events[traceInfo.events.length - 1];\n  var processedEvents = [];\n\n  if(firstEvent.type != 'start') {\n    console.warn('Kadira: trace is not started yet');\n    return null;\n  } else if(lastEvent.type != 'complete' && lastEvent.type != 'error') {\n    //trace is not completed or errored yet\n    console.warn('Kadira: trace is not completed or errored yet');\n    return null;\n  } else {\n    //build the metrics\n    traceInfo.errored = lastEvent.type == 'error';\n    traceInfo.at = firstEvent.at;\n\n    var metrics = {\n      total: lastEvent.at - firstEvent.at,\n    };\n\n    var totalNonCompute = 0;\n\n    firstEvent = ['start', 0];\n    if(traceInfo.events[0].data) firstEvent.push(traceInfo.events[0].data);\n    processedEvents.push(firstEvent);\n\n    for(var lc=1; lc < traceInfo.events.length - 1; lc += 2) {\n      var prevEventEnd = traceInfo.events[lc-1];\n      var startEvent = traceInfo.events[lc];\n      var endEvent = traceInfo.events[lc+1];\n      var computeTime = startEvent.at - prevEventEnd.at;\n      if(computeTime > 0) processedEvents.push(['compute', computeTime]);\n      if(!endEvent) {\n        console.error('Kadira: no end event for type: ', startEvent.type);\n        return null;\n      } else if(endEvent.type != startEvent.type + 'end') {\n        console.error('Kadira: endevent type mismatch: ', startEvent.type, endEvent.type, JSON.stringify(traceInfo));\n        return null;\n      } else {\n        var elapsedTimeForEvent = endEvent.at - startEvent.at\n        var currentEvent = [startEvent.type, elapsedTimeForEvent];\n        currentEvent.push(Object.assign({}, startEvent.data, endEvent.data));\n        processedEvents.push(currentEvent);\n        metrics[startEvent.type] = metrics[startEvent.type] || 0;\n        metrics[startEvent.type] += elapsedTimeForEvent;\n        totalNonCompute += elapsedTimeForEvent;\n      }\n    }\n\n    computeTime = lastEvent.at - traceInfo.events[traceInfo.events.length - 2];\n    if(computeTime > 0) processedEvents.push(['compute', computeTime]);\n\n    var lastEventData = [lastEvent.type, 0];\n    if(lastEvent.data) lastEventData.push(lastEvent.data);\n    processedEvents.push(lastEventData);\n\n    metrics.compute = metrics.total - totalNonCompute;\n    traceInfo.metrics = metrics;\n    traceInfo.events = processedEvents;\n    traceInfo.isEventsProcessed = true;\n    return traceInfo;\n  }\n};\n\nTracer.prototype.addFilter = function(filterFn) {\n  this._filters.push(filterFn);\n};\n\nTracer.prototype._applyFilters = function(eventType, data, info) {\n  this._filters.forEach(function(filterFn) {\n    data = filterFn(eventType, _.clone(data), info);\n  });\n\n  return data;\n};\n\nKadira.tracer = new Tracer();\n// need to expose Tracer to provide default set of filters\nKadira.Tracer = Tracer;","// strip sensitive data sent to kadia engine.\n// possible to limit types by providing an array of types to strip\n// possible types are: \"start\", \"db\", \"http\", \"email\"\nTracer.stripSensitive = function stripSensitive(typesToStrip, receiverType, name) {\n  typesToStrip =  typesToStrip || [];\n\n  var strippedTypes = {};\n  typesToStrip.forEach(function(type) {\n    strippedTypes[type] = true;\n  });\n\n  return function (type, data, info) {\n    if(typesToStrip.length > 0 && !strippedTypes[type])\n      return data;\n\n    if(receiverType && receiverType != info.type)\n      return data;\n\n    if(name && name != info.name)\n      return data;\n\n    if(type == \"start\") {\n      data.params = \"[stripped]\";\n    } else if(type == \"db\") {\n      data.selector = \"[stripped]\";\n    } else if(type == \"http\") {\n      data.url = \"[stripped]\";\n    } else if(type == \"email\") {\n      [\"from\", \"to\", \"cc\", \"bcc\", \"replyTo\"].forEach(function(item) {\n        if(data[item]) {\n          data[item] = \"[stripped]\";\n        }\n      });\n    }\n\n    return data;\n  };\n};\n\n// strip selectors only from the given list of collection names\nTracer.stripSelectors = function stripSelectors(collectionList, receiverType, name) {\n  collectionList = collectionList || [];\n\n  var collMap = {};\n  collectionList.forEach(function(collName) {\n    collMap[collName] = true;\n  });\n\n  return function(type, data, info) {\n    if(type != \"db\" || (data && !collMap[data.coll])) {\n      return data\n    }\n\n    if(receiverType && receiverType != info.type)\n      return data;\n\n    if(name && name != info.name)\n      return data;\n\n    data.selector = \"[stripped]\";\n    return data;\n  };\n}","var logger = Npm.require('debug')('kadira:ts');\n\nTracerStore = function TracerStore(options) {\n  options = options || {};\n\n  this.maxTotalPoints = options.maxTotalPoints || 30;\n  this.interval = options.interval || 1000 * 60;\n  this.archiveEvery = options.archiveEvery || this.maxTotalPoints / 6;\n\n  //store max total on the past 30 minutes (or past 30 items)\n  this.maxTotals = Object.create(null);\n  //store the max trace of the current interval\n  this.currentMaxTrace = Object.create(null);\n  //archive for the traces\n  this.traceArchive = [];\n\n  this.processedCnt = Object.create(null);\n\n  //group errors by messages between an interval\n  this.errorMap = Object.create(null);\n};\n\nTracerStore.prototype.addTrace = function(trace) {\n  var kind = [trace.type, trace.name].join('::');\n  if(!this.currentMaxTrace[kind]) {\n    this.currentMaxTrace[kind] = EJSON.clone(trace);\n  } else if(this.currentMaxTrace[kind].metrics.total < trace.metrics.total) {\n    this.currentMaxTrace[kind] = EJSON.clone(trace);\n  } else if(trace.errored) {\n    this._handleErrors(trace);\n  }\n};\n\nTracerStore.prototype.collectTraces = function() {\n  var traces = this.traceArchive;\n  this.traceArchive = [];\n\n  // convert at(timestamp) into the actual serverTime\n  traces.forEach(function(trace) {\n    trace.at = Kadira.syncedDate.syncTime(trace.at);\n  });\n  return traces;\n};\n\nTracerStore.prototype.start = function() {\n  this._timeoutHandler = setInterval(this.processTraces.bind(this), this.interval);\n};\n\nTracerStore.prototype.stop = function() {\n  if(this._timeoutHandler) {\n    clearInterval(this._timeoutHandler);\n  }\n};\n\nTracerStore.prototype._handleErrors = function(trace) {\n  // sending error requests as it is\n  var lastEvent = trace.events[trace.events.length -1];\n  if(lastEvent && lastEvent[2]) {\n    var error = lastEvent[2].error;\n\n    // grouping errors occured (reset after processTraces)\n    var errorKey = [trace.type, trace.name, error.message].join(\"::\");\n    if(!this.errorMap[errorKey]) {\n      var erroredTrace = EJSON.clone(trace);\n      this.errorMap[errorKey] = erroredTrace;\n\n      this.traceArchive.push(erroredTrace);\n    }\n  } else {\n    logger('last events is not an error: ', JSON.stringify(trace.events));\n  }\n};\n\nTracerStore.prototype.processTraces = function() {\n  var self = this;\n  var kinds = _.union(\n    _.keys(this.maxTotals),\n    _.keys(this.currentMaxTrace)\n  );\n\n  kinds.forEach(function(kind) {\n    self.processedCnt[kind] = self.processedCnt[kind] || 0;\n    var currentMaxTrace = self.currentMaxTrace[kind];\n    var currentMaxTotal = currentMaxTrace? currentMaxTrace.metrics.total : 0;\n\n    self.maxTotals[kind] = self.maxTotals[kind] || [];\n    //add the current maxPoint\n    self.maxTotals[kind].push(currentMaxTotal);\n    var exceedingPoints = self.maxTotals[kind].length - self.maxTotalPoints;\n    if(exceedingPoints > 0) {\n      self.maxTotals[kind].splice(0, exceedingPoints);\n    }\n\n    var archiveDefault = (self.processedCnt[kind] % self.archiveEvery) == 0;\n    self.processedCnt[kind]++;\n\n    var canArchive = archiveDefault\n      || self._isTraceOutlier(kind, currentMaxTrace);\n\n    if(canArchive && currentMaxTrace) {\n      self.traceArchive.push(currentMaxTrace);\n    }\n\n    //reset currentMaxTrace\n    self.currentMaxTrace[kind] = null;\n  });\n\n  //reset the errorMap\n  self.errorMap = Object.create(null);\n};\n\nTracerStore.prototype._isTraceOutlier = function(kind, trace) {\n  if(trace) {\n    var dataSet = this.maxTotals[kind];\n    return this._isOutlier(dataSet, trace.metrics.total, 3);\n  } else {\n    return false;\n  }\n};\n\n/*\n  Data point must exists in the dataSet\n*/\nTracerStore.prototype._isOutlier = function(dataSet, dataPoint, maxMadZ) {\n  var median = this._getMedian(dataSet);\n  var mad = this._calculateMad(dataSet, median);\n  var madZ = this._funcMedianDeviation(median)(dataPoint) / mad;\n\n  return madZ > maxMadZ;\n};\n\nTracerStore.prototype._getMedian = function(dataSet) {\n  var sortedDataSet = _.clone(dataSet).sort(function(a, b) {\n    return a-b;\n  });\n  return this._pickQuartile(sortedDataSet, 2);\n};\n\nTracerStore.prototype._pickQuartile = function(dataSet, num) {\n  var pos = ((dataSet.length + 1) * num) / 4;\n  if(pos % 1 == 0) {\n    return dataSet[pos -1];\n  } else {\n    pos = pos - (pos % 1);\n    return (dataSet[pos -1] + dataSet[pos])/2\n  }\n};\n\nTracerStore.prototype._calculateMad = function(dataSet, median) {\n  var medianDeviations = _.map(dataSet, this._funcMedianDeviation(median));\n  var mad = this._getMedian(medianDeviations);\n\n  return mad;\n};\n\nTracerStore.prototype._funcMedianDeviation = function(median) {\n  return function(x) {\n    return Math.abs(median - x);\n  };\n};\n\nTracerStore.prototype._getMean = function(dataPoints) {\n  if(dataPoints.length > 0) {\n    var total = 0;\n    dataPoints.forEach(function(point) {\n      total += point;\n    });\n    return total/dataPoints.length;\n  } else {\n    return 0;\n  }\n};\n","var LRU = Npm.require('lru-cache');\nvar crypto = Npm.require('crypto');\nvar jsonStringify = Npm.require('json-stringify-safe');\n\nDocSzCache = function (maxItems, maxValues) {\n  this.items = new LRU({max: maxItems});\n  this.maxValues = maxValues;\n  this.cpuUsage = 0;\n}\n\n// This is called from SystemModel.prototype.getUsage and saves cpu usage.\nDocSzCache.prototype.setPcpu = function (pcpu) {\n  this.cpuUsage = pcpu;\n};\n\nDocSzCache.prototype.getSize = function (coll, query, opts, data) {\n  // If the dataset is null or empty we can't calculate the size\n  // Do not process this data and return 0 as the document size.\n  if (!(data && (data.length || data.size))) {\n    return 0;\n  }\n\n  var key = this.getKey(coll, query, opts);\n  var item = this.items.get(key);\n\n  if (!item) {\n    item = new DocSzCacheItem(this.maxValues);\n    this.items.set(key, item);\n  }\n\n  if (this.needsUpdate(item)) {\n    var doc = {};\n    if(typeof data.get === 'function'){\n      // This is an IdMap\n      data.forEach(function(element){\n        doc = element;\n        return false; // return false to stop loop. We only need one doc.\n      })\n    } else {\n      doc = data[0];\n    }\n    var size = Buffer.byteLength(jsonStringify(doc), 'utf8');\n    item.addData(size);\n  }\n\n  return item.getValue();\n};\n\nDocSzCache.prototype.getKey = function (coll, query, opts) {\n  return jsonStringify([coll, query, opts]);\n};\n\n// returns a score between 0 and 1 for a cache item\n// this score is determined by:\n//  * availalbe cache item slots\n//  * time since last updated\n//  * cpu usage of the application\nDocSzCache.prototype.getItemScore = function (item) {\n  return [\n    (item.maxValues - item.values.length)/item.maxValues,\n    (Date.now() - item.updated) / 60000,\n    (100 - this.cpuUsage) / 100,\n  ].map(function (score) {\n    return score > 1 ? 1 : score;\n  }).reduce(function (total, score) {\n    return (total || 0) + score;\n  }) / 3;\n};\n\nDocSzCache.prototype.needsUpdate = function (item) {\n  // handle newly made items\n  if (!item.values.length) {\n    return true;\n  }\n\n  var currentTime = Date.now();\n  var timeSinceUpdate = currentTime - item.updated;\n  if (timeSinceUpdate > 1000*60) {\n    return true;\n  }\n\n  return this.getItemScore(item) > 0.5;\n};\n\n\nDocSzCacheItem = function (maxValues) {\n  this.maxValues = maxValues;\n  this.updated = 0;\n  this.values = [];\n}\n\nDocSzCacheItem.prototype.addData = function (value) {\n  this.values.push(value);\n  this.updated = Date.now();\n\n  if (this.values.length > this.maxValues) {\n    this.values.shift();\n  }\n};\n\nDocSzCacheItem.prototype.getValue = function () {\n  function sortNumber(a, b) {\n    return a - b;\n  }\n  var sorted = this.values.sort(sortNumber);\n  var median = 0;\n\n  if (sorted.length % 2 === 0) {\n    var idx = sorted.length / 2;\n    median = (sorted[idx] + sorted[idx-1]) / 2;\n  } else {\n    var idx = Math.floor(sorted.length / 2);\n    median = sorted[idx];\n  }\n\n  return median;\n};\n","var hostname = Npm.require('os').hostname();\nvar logger = Npm.require('debug')('kadira:apm');\nvar Fibers = Npm.require('fibers');\n\nvar KadiraCore = Npm.require('kadira-core').Kadira;\n\nKadira.models = {};\nKadira.options = {};\nKadira.env = {\n  currentSub: null, // keep current subscription inside ddp\n  kadiraInfo: new Meteor.EnvironmentVariable(),\n};\nKadira.waitTimeBuilder = new WaitTimeBuilder();\nKadira.errors = [];\nKadira.errors.addFilter = Kadira.errors.push.bind(Kadira.errors);\n\nKadira.models.methods = new MethodsModel();\nKadira.models.pubsub = new PubsubModel();\nKadira.models.system = new SystemModel();\nKadira.docSzCache = new DocSzCache(100000, 10);\n\n\nKadira.connect = function(appId, appSecret, options) {\n  options = options || {};\n  options.appId = appId;\n  options.appSecret = appSecret;\n  options.payloadTimeout = options.payloadTimeout || 1000 * 20;\n  options.endpoint = options.endpoint || \"https://enginex.kadira.io\";\n  options.clientEngineSyncDelay = options.clientEngineSyncDelay || 10000;\n  options.thresholds = options.thresholds || {};\n  options.isHostNameSet = !!options.hostname;\n  options.hostname = options.hostname || hostname;\n  options.proxy = options.proxy || null;\n\n  if(options.documentSizeCacheSize) {\n    Kadira.docSzCache = new DocSzCache(options.documentSizeCacheSize, 10);\n  }\n\n  // remove trailing slash from endpoint url (if any)\n  if(_.last(options.endpoint) === '/') {\n    options.endpoint = options.endpoint.substr(0, options.endpoint.length - 1);\n  }\n\n  // error tracking is enabled by default\n  if(options.enableErrorTracking === undefined) {\n    options.enableErrorTracking = true;\n  }\n\n  Kadira.options = options;\n  Kadira.options.authHeaders = {\n    'KADIRA-APP-ID': Kadira.options.appId,\n    'KADIRA-APP-SECRET': Kadira.options.appSecret\n  };\n\n  Kadira.syncedDate = new Ntp(options.endpoint);\n  Kadira.syncedDate.sync();\n  Kadira.models.error = new ErrorModel(appId);\n\n  // handle pre-added filters\n  var addFilterFn = Kadira.models.error.addFilter.bind(Kadira.models.error);\n  Kadira.errors.forEach(addFilterFn);\n  Kadira.errors = Kadira.models.error;\n\n  // setting runtime info, which will be sent to kadira\n  __meteor_runtime_config__.kadira = {\n    appId: appId,\n    endpoint: options.endpoint,\n    clientEngineSyncDelay: options.clientEngineSyncDelay,\n  };\n\n  if(options.enableErrorTracking) {\n    Kadira.enableErrorTracking();\n  } else {\n    Kadira.disableErrorTracking();\n  }\n\n  if(appId && appSecret) {\n    options.appId = options.appId.trim();\n    options.appSecret = options.appSecret.trim();\n\n    Kadira.coreApi = new KadiraCore({\n      appId: options.appId,\n      appSecret: options.appSecret,\n      endpoint: options.endpoint,\n      hostname: options.hostname\n    });\n\n    Kadira.coreApi._checkAuth()\n      .then(function() {\n        logger('connected to app: ', appId);\n        console.log('Meteor APM: Successfully connected');\n        Kadira._sendAppStats();\n        Kadira._schedulePayloadSend();\n      })\n      .catch(function(err) {\n        console.log('Meteor APM: authentication failed - check your appId & appSecret')\n      });\n  } else {\n    throw new Error('Meteor APM: required appId and appSecret');\n  }\n\n  // start tracking errors\n  Meteor.startup(function () {\n    TrackUncaughtExceptions();\n    TrackMeteorDebug();\n  })\n\n  Meteor.publish(null, function () {\n    var options = __meteor_runtime_config__.kadira;\n    this.added('kadira_settings', Random.id(), options);\n    this.ready();\n  });\n\n  // notify we've connected\n  Kadira.connected = true;\n};\n\n//track how many times we've sent the data (once per minute)\nKadira._buildPayload = function () {\n  var payload = {host: Kadira.options.hostname};\n  var buildDetailedInfo = Kadira._isDetailedInfo();\n  Object.assign(payload, Kadira.models.methods.buildPayload(buildDetailedInfo));\n  Object.assign(payload, Kadira.models.pubsub.buildPayload(buildDetailedInfo));\n  Object.assign(payload, Kadira.models.system.buildPayload());\n  if(Kadira.options.enableErrorTracking) {\n    Object.assign(payload, Kadira.models.error.buildPayload());\n  }\n\n  return payload;\n}\n\nKadira._countDataSent = 0;\nKadira._detailInfoSentInterval = Math.ceil((1000*60) / Kadira.options.payloadTimeout);\nKadira._isDetailedInfo = function () {\n  return (Kadira._countDataSent++ % Kadira._detailInfoSentInterval) == 0;\n}\n\nKadira._sendAppStats = function () {\n  var appStats = {};\n  appStats.release = Meteor.release;\n  appStats.protocolVersion = '1.0.0';\n  appStats.packageVersions = [];\n  appStats.appVersions = {\n    webapp: __meteor_runtime_config__['autoupdateVersion'],\n    refreshable: __meteor_runtime_config__['autoupdateVersionRefreshable'],\n    cordova: __meteor_runtime_config__['autoupdateVersionCordova']\n  }\n\n  // TODO get version number for installed packages\n  _.each(Package, function (v, name) {\n    appStats.packageVersions.push({name: name, version: null});\n  });\n\n  Kadira.coreApi.sendData({\n    startTime: new Date(),\n    appStats: appStats\n  }).catch(function(err) {\n    console.error('Kadira Error on sending appStats:', err.message);\n  });\n}\n\nKadira._schedulePayloadSend = function () {\n  setTimeout(function () {\n    Kadira._sendPayload(Kadira._schedulePayloadSend);\n  }, Kadira.options.payloadTimeout);\n}\n\nKadira._sendPayload = function (callback) {\n  new Fibers(function() {\n    var payload = Kadira._buildPayload();\n    Kadira.coreApi.sendData(payload)\n    .then(callback)\n    .catch(function(err) {\n      console.log('Meteor APM Error:', err.message);\n      callback();\n    });\n  }).run();\n}\n\n// this return the __kadiraInfo from the current Fiber by default\n// if called with 2nd argument as true, it will get the kadira info from\n// Meteor.EnvironmentVariable\n//\n// WARNING: returned info object is the reference object.\n//  Changing it might cause issues when building traces. So use with care\nKadira._getInfo = function(currentFiber, useEnvironmentVariable) {\n  currentFiber = currentFiber || Fibers.current;\n  if(currentFiber) {\n    if(useEnvironmentVariable) {\n      return Kadira.env.kadiraInfo.get();\n    }\n    return currentFiber.__kadiraInfo;\n  }\n};\n\n// this does not clone the info object. So, use with care\nKadira._setInfo = function(info) {\n  Fibers.current.__kadiraInfo = info;\n};\n\nKadira.enableErrorTracking = function () {\n  __meteor_runtime_config__.kadira.enableErrorTracking = true;\n  Kadira.options.enableErrorTracking = true;\n};\n\nKadira.disableErrorTracking = function () {\n  __meteor_runtime_config__.kadira.enableErrorTracking = false;\n  Kadira.options.enableErrorTracking = false;\n};\n\nKadira.trackError = function (type, message, options) {\n  if(Kadira.options.enableErrorTracking && type && message) {\n    options = options || {};\n    options.subType = options.subType || 'server';\n    options.stacks = options.stacks || '';\n    var error = {message: message, stack: options.stacks};\n    var trace = {\n      type: type,\n      subType: options.subType,\n      name: message,\n      errored: true,\n      at: Kadira.syncedDate.getTime(),\n      events: [['start', 0, {}], ['error', 0, {error: error}]],\n      metrics: {total: 0}\n    };\n    Kadira.models.error.trackError(error, trace);\n  }\n}\n\nKadira.ignoreErrorTracking = function (err) {\n  err._skipKadira = true;\n}\n","var Fiber = Npm.require('fibers');\n\nwrapServer = function(serverProto) {\n  var originalHandleConnect = serverProto._handleConnect\n  serverProto._handleConnect = function(socket, msg) {\n    originalHandleConnect.call(this, socket, msg);\n    var session = socket._meteorSession;\n    // sometimes it is possible for _meteorSession to be undefined\n    // one such reason would be if DDP versions are not matching\n    // if then, we should not process it\n    if(!session) {\n      return;\n    }\n\n    Kadira.EventBus.emit('system', 'createSession', msg, socket._meteorSession);\n\n    if(Kadira.connected) {\n      Kadira.models.system.handleSessionActivity(msg, socket._meteorSession);\n    }\n  };\n};\n","wrapSession = function(sessionProto) {\n  var originalProcessMessage = sessionProto.processMessage;\n  sessionProto.processMessage = function(msg) {\n    if(true) {\n      var kadiraInfo = {\n        session: this.id,\n        userId: this.userId\n      };\n\n      if(msg.msg == 'method' || msg.msg == 'sub') {\n        kadiraInfo.trace = Kadira.tracer.start(this, msg);\n        Kadira.waitTimeBuilder.register(this, msg.id);\n\n        //use JSON stringify to save the CPU\n        var startData = { userId: this.userId, params: JSON.stringify(msg.params) };\n        Kadira.tracer.event(kadiraInfo.trace, 'start', startData);\n        var waitEventId = Kadira.tracer.event(kadiraInfo.trace, 'wait', {}, kadiraInfo);\n        msg._waitEventId = waitEventId;\n        msg.__kadiraInfo = kadiraInfo;\n\n        if(msg.msg == 'sub') {\n          // start tracking inside processMessage allows us to indicate\n          // wait time as well\n          Kadira.EventBus.emit('pubsub', 'subReceived', this, msg);\n          Kadira.models.pubsub._trackSub(this, msg);\n        }\n      }\n\n      // Update session last active time\n      Kadira.EventBus.emit('system', 'ddpMessageReceived', this, msg);\n      Kadira.models.system.handleSessionActivity(msg, this);\n    }\n\n    return originalProcessMessage.call(this, msg);\n  };\n\n  //adding the method context to the current fiber\n  var originalMethodHandler = sessionProto.protocol_handlers.method;\n  sessionProto.protocol_handlers.method = function(msg, unblock) {\n    var self = this;\n    //add context\n    var kadiraInfo = msg.__kadiraInfo;\n    if(kadiraInfo) {\n      Kadira._setInfo(kadiraInfo);\n\n      // end wait event\n      var waitList = Kadira.waitTimeBuilder.build(this, msg.id);\n      Kadira.tracer.eventEnd(kadiraInfo.trace, msg._waitEventId, {waitOn: waitList});\n\n      unblock = Kadira.waitTimeBuilder.trackWaitTime(this, msg, unblock);\n      var response = Kadira.env.kadiraInfo.withValue(kadiraInfo, function () {\n        return originalMethodHandler.call(self, msg, unblock);\n      });\n      unblock();\n    } else {\n      var response = originalMethodHandler.call(self, msg, unblock);\n    }\n\n    return response;\n  };\n\n  //to capture the currently processing message\n  var orginalSubHandler = sessionProto.protocol_handlers.sub;\n  sessionProto.protocol_handlers.sub = function(msg, unblock) {\n    var self = this;\n    //add context\n    var kadiraInfo = msg.__kadiraInfo;\n    if(kadiraInfo) {\n      Kadira._setInfo(kadiraInfo);\n\n      // end wait event\n      var waitList = Kadira.waitTimeBuilder.build(this, msg.id);\n      Kadira.tracer.eventEnd(kadiraInfo.trace, msg._waitEventId, {waitOn: waitList});\n\n      unblock = Kadira.waitTimeBuilder.trackWaitTime(this, msg, unblock);\n      var response = Kadira.env.kadiraInfo.withValue(kadiraInfo, function () {\n        return orginalSubHandler.call(self, msg, unblock);\n      });\n      unblock();\n    } else {\n      var response = orginalSubHandler.call(self, msg, unblock);\n    }\n\n    return response;\n  };\n\n  //to capture the currently processing message\n  var orginalUnSubHandler = sessionProto.protocol_handlers.unsub;\n  sessionProto.protocol_handlers.unsub = function(msg, unblock) {\n    unblock = Kadira.waitTimeBuilder.trackWaitTime(this, msg, unblock);\n    var response = orginalUnSubHandler.call(this, msg, unblock);\n    unblock();\n    return response;\n  };\n\n  //track method ending (to get the result of error)\n  var originalSend = sessionProto.send;\n  sessionProto.send = function(msg) {\n    if(msg.msg == 'result') {\n      var kadiraInfo = Kadira._getInfo();\n      if(kadiraInfo) {\n        if(msg.error) {\n          var error = _.pick(msg.error, ['message', 'stack']);\n\n          // pick the error from the wrapped method handler\n          if(kadiraInfo && kadiraInfo.currentError) {\n            // the error stack is wrapped so Meteor._debug can identify\n            // this as a method error.\n            error = _.pick(kadiraInfo.currentError, ['message', 'stack']);\n            // see wrapMethodHanderForErrors() method def for more info\n            if(error.stack && error.stack.stack) {\n              error.stack = error.stack.stack;\n            }\n          }\n\n          Kadira.tracer.endLastEvent(kadiraInfo.trace);\n          Kadira.tracer.event(kadiraInfo.trace, 'error', {error: error});\n        } else {\n          Kadira.tracer.endLastEvent(kadiraInfo.trace);\n          Kadira.tracer.event(kadiraInfo.trace, 'complete');\n        }\n\n        //processing the message\n        var trace = Kadira.tracer.buildTrace(kadiraInfo.trace);\n        Kadira.EventBus.emit('method', 'methodCompleted', trace, this);\n        Kadira.models.methods.processMethod(trace);\n\n        // error may or may not exist and error tracking can be disabled\n        if(error && Kadira.options.enableErrorTracking) {\n          Kadira.models.error.trackError(error, trace);\n        }\n\n        //clean and make sure, fiber is clean\n        //not sure we need to do this, but a preventive measure\n        Kadira._setInfo(null);\n      }\n    }\n\n    return originalSend.call(this, msg);\n  };\n};\n\n// wrap existing method handlers for capturing errors\n_.each(Meteor.server.method_handlers, function(handler, name) {\n  wrapMethodHanderForErrors(name, handler, Meteor.server.method_handlers);\n});\n\n// wrap future method handlers for capturing errors\nvar originalMeteorMethods = Meteor.methods;\nMeteor.methods = function(methodMap) {\n  _.each(methodMap, function(handler, name) {\n    wrapMethodHanderForErrors(name, handler, methodMap);\n  });\n  originalMeteorMethods(methodMap);\n};\n\n\nfunction wrapMethodHanderForErrors(name, originalHandler, methodMap) {\n  methodMap[name] = function() {\n    try{\n      return originalHandler.apply(this, arguments);\n    } catch(ex) {\n      if(ex && Kadira._getInfo()) {\n        // sometimes error may be just an string or a primitive\n        // in that case, we need to make it a psuedo error\n        if(typeof ex !== 'object') {\n          ex = {message: ex, stack: ex};\n        }\n        // Now we are marking this error to get tracked via methods\n        // But, this also triggers a Meteor.debug call and\n        // it only gets the stack\n        // We also track Meteor.debug errors and want to stop\n        // tracking this error. That's why we do this\n        // See Meteor.debug error tracking code for more\n        if (Kadira.options.enableErrorTracking) {\n          ex.stack = {stack: ex.stack, source: 'method'};\n        }\n        Kadira._getInfo().currentError = ex;\n      }\n      throw ex;\n    }\n  }\n}\n","var Fiber = Npm.require('fibers');\n\nwrapSubscription = function(subscriptionProto) {\n  // If the ready event runs outside the Fiber, Kadira._getInfo() doesn't work.\n  // we need some other way to store kadiraInfo so we can use it at ready hijack.\n  var originalRunHandler = subscriptionProto._runHandler;\n  subscriptionProto._runHandler = function() {\n    var kadiraInfo = Kadira._getInfo();\n    if (kadiraInfo) {\n      this.__kadiraInfo = kadiraInfo;\n    };\n    originalRunHandler.call(this);\n  }\n\n  var originalReady = subscriptionProto.ready;\n  subscriptionProto.ready = function() {\n    // meteor has a field called `_ready` which tracks this\n    // but we need to make it future proof\n    if(!this._apmReadyTracked) {\n      var kadiraInfo = Kadira._getInfo() || this.__kadiraInfo;\n      delete this.__kadiraInfo;\n      //sometime .ready can be called in the context of the method\n      //then we have some problems, that's why we are checking this\n      //eg:- Accounts.createUser\n      if(kadiraInfo && this._subscriptionId == kadiraInfo.trace.id) {\n        Kadira.tracer.endLastEvent(kadiraInfo.trace);\n        Kadira.tracer.event(kadiraInfo.trace, 'complete');\n        var trace = Kadira.tracer.buildTrace(kadiraInfo.trace);\n      }\n\n      Kadira.EventBus.emit('pubsub', 'subCompleted', trace, this._session, this);\n      Kadira.models.pubsub._trackReady(this._session, this, trace);\n      this._apmReadyTracked = true;\n    }\n\n    // we still pass the control to the original implementation\n    // since multiple ready calls are handled by itself\n    originalReady.call(this);\n  };\n\n  var originalError = subscriptionProto.error;\n  subscriptionProto.error = function(err) {\n    if (err) {\n      var kadiraInfo = Kadira._getInfo();\n\n      if(kadiraInfo && this._subscriptionId == kadiraInfo.trace.id) {\n        Kadira.tracer.endLastEvent(kadiraInfo.trace);\n\n        var errorForApm = _.pick(err, 'message', 'stack');\n        Kadira.tracer.event(kadiraInfo.trace, 'error', {error: errorForApm});\n        var trace = Kadira.tracer.buildTrace(kadiraInfo.trace);\n\n        Kadira.models.pubsub._trackError(this._session, this, trace);\n\n        // error tracking can be disabled and if there is a trace\n        // trace should be avaialble all the time, but it won't\n        // if something wrong happened on the trace building\n        if(Kadira.options.enableErrorTracking && trace) {\n          Kadira.models.error.trackError(err, trace);\n        }\n      }\n\n      // wrap error stack so Meteor._debug can identify and ignore it\n      if (Kadira.options.enableErrorTracking) {\n        err.stack = { stack: err.stack, source: \"subscription\" };\n      }\n      originalError.call(this, err);\n    }\n  };\n\n  var originalDeactivate = subscriptionProto._deactivate;\n  subscriptionProto._deactivate = function() {\n    Kadira.EventBus.emit('pubsub', 'subDeactivated', this._session, this);\n    Kadira.models.pubsub._trackUnsub(this._session, this);\n    originalDeactivate.call(this);\n  };\n\n  //adding the currenSub env variable\n  ['added', 'changed', 'removed'].forEach(function(funcName) {\n    var originalFunc = subscriptionProto[funcName];\n    subscriptionProto[funcName] = function(collectionName, id, fields) {\n      var self = this;\n\n      // we need to run this code in a fiber and that's how we track\n      // subscription info. May be we can figure out, some other way to do this\n      // We use this currently to get the publication info when tracking message\n      // sizes at wrap_ddp_stringify.js\n      Kadira.env.currentSub = self;\n      var res = originalFunc.call(self, collectionName, id, fields);\n      Kadira.env.currentSub = null;\n\n      return res;\n    };\n  });\n};\n","import { MongoConnection } from \"./meteorx.js\";\n\nwrapOplogObserveDriver = function(proto) {\n  // Track the polled documents. This is reflect to the RAM size and\n  // for the CPU usage directly\n  var originalPublishNewResults = proto._publishNewResults;\n  proto._publishNewResults = function(newResults, newBuffer) {\n    var coll = this._cursorDescription.collectionName;\n    var query = this._cursorDescription.selector;\n    var opts = this._cursorDescription.options;\n    var docSize = Kadira.docSzCache.getSize(coll, query, opts, newResults);\n    var docSize = Kadira.docSzCache.getSize(coll, query, opts, newBuffer);\n    var count = newResults.size() + newBuffer.size();\n    if(this._ownerInfo) {\n      Kadira.models.pubsub.trackPolledDocuments(this._ownerInfo, count);\n      Kadira.models.pubsub.trackDocSize(this._ownerInfo.name, \"polledFetches\", docSize*count);\n    } else {\n      this._polledDocuments = count;\n      this._docSize = {\n        polledFetches: docSize*count\n      }\n    }\n    return originalPublishNewResults.call(this, newResults, newBuffer);\n  };\n\n  var originalHandleOplogEntryQuerying = proto._handleOplogEntryQuerying;\n  proto._handleOplogEntryQuerying = function(op) {\n    Kadira.models.pubsub.trackDocumentChanges(this._ownerInfo, op);\n    return originalHandleOplogEntryQuerying.call(this, op);\n  };\n\n  var originalHandleOplogEntrySteadyOrFetching = proto._handleOplogEntrySteadyOrFetching;\n  proto._handleOplogEntrySteadyOrFetching = function(op) {\n    Kadira.models.pubsub.trackDocumentChanges(this._ownerInfo, op);\n    return originalHandleOplogEntrySteadyOrFetching.call(this, op);\n  };\n\n  // track live updates\n  ['_addPublished', '_removePublished', '_changePublished'].forEach(function(fnName) {\n    var originalFn = proto[fnName];\n    proto[fnName] = function(a, b, c) {\n      if(this._ownerInfo) {\n        Kadira.models.pubsub.trackLiveUpdates(this._ownerInfo, fnName, 1);\n\n        if(fnName === \"_addPublished\") {\n          var coll = this._cursorDescription.collectionName;\n          var query = this._cursorDescription.selector;\n          var opts = this._cursorDescription.options;\n          var docSize = Kadira.docSzCache.getSize(coll, query, opts, [b]);\n\n          Kadira.models.pubsub.trackDocSize(this._ownerInfo.name, \"liveFetches\", docSize);\n        }\n      } else {\n        // If there is no ownerInfo, that means this is the initial adds\n        if(!this._liveUpdatesCounts) {\n          this._liveUpdatesCounts = {\n            _initialAdds: 0\n          };\n        }\n\n        this._liveUpdatesCounts._initialAdds++;\n\n        if(fnName === \"_addPublished\") {\n          if(!this._docSize) {\n            this._docSize = {\n              initialFetches: 0\n            };\n          }\n\n          if(!this._docSize.initialFetches) {\n            this._docSize.initialFetches = 0;\n          }\n\n          var coll = this._cursorDescription.collectionName;\n          var query = this._cursorDescription.selector;\n          var opts = this._cursorDescription.options;\n          var docSize = Kadira.docSzCache.getSize(coll, query, opts, [b]);\n\n          this._docSize.initialFetches += docSize;\n        }\n      }\n\n      return originalFn.call(this, a, b, c);\n    };\n  });\n\n  var originalStop = proto.stop;\n  proto.stop = function() {\n    if(this._ownerInfo && this._ownerInfo.type === 'sub') {\n      Kadira.EventBus.emit('pubsub', 'observerDeleted', this._ownerInfo);\n      Kadira.models.pubsub.trackDeletedObserver(this._ownerInfo);\n    }\n\n    return originalStop.call(this);\n  };\n};\n\nwrapPollingObserveDriver = function(proto) {\n  var originalPollMongo = proto._pollMongo;\n  proto._pollMongo = function() {\n    var start = Date.now();\n    originalPollMongo.call(this);\n\n    // Current result is stored in the following variable.\n    // So, we can use that\n    // Sometimes, it's possible to get size as undefined.\n    // May be something with different version. We don't need to worry about\n    // this now\n    var count = 0;\n    var docSize = 0;\n\n    if(this._results && this._results.size) {\n      count = this._results.size() || 0;\n\n      var coll = this._cursorDescription.collectionName;\n      var query = this._cursorDescription.selector;\n      var opts = this._cursorDescription.options;\n\n      docSize = Kadira.docSzCache.getSize(coll, query, opts, this._results._map)*count;\n    }\n\n    if(this._ownerInfo) {\n      Kadira.models.pubsub.trackPolledDocuments(this._ownerInfo, count);\n      Kadira.models.pubsub.trackDocSize(this._ownerInfo.name, \"polledFetches\", docSize);\n    } else {\n      this._polledDocuments = count;\n      this._polledDocSize = docSize;\n    }\n  };\n\n  var originalStop = proto.stop;\n  proto.stop = function() {\n    if(this._ownerInfo && this._ownerInfo.type === 'sub') {\n      Kadira.EventBus.emit('pubsub', 'observerDeleted', this._ownerInfo);\n      Kadira.models.pubsub.trackDeletedObserver(this._ownerInfo);\n    }\n\n    return originalStop.call(this);\n  };\n};\n\nwrapMultiplexer = function(proto) {\n  var originalInitalAdd = proto.addHandleAndSendInitialAdds;\n   proto.addHandleAndSendInitialAdds = function(handle) {\n    if(!this._firstInitialAddTime) {\n      this._firstInitialAddTime = Date.now();\n    }\n\n    handle._wasMultiplexerReady = this._ready();\n    handle._queueLength = this._queue._taskHandles.length;\n\n    if(!handle._wasMultiplexerReady) {\n      handle._elapsedPollingTime = Date.now() - this._firstInitialAddTime;\n    }\n    return originalInitalAdd.call(this, handle);\n  };\n};\n\nwrapForCountingObservers = function() {\n  // to count observers\n  var mongoConnectionProto = MongoConnection.prototype;\n  var originalObserveChanges = mongoConnectionProto._observeChanges;\n  mongoConnectionProto._observeChanges = function(cursorDescription, ordered, callbacks) {\n    var ret = originalObserveChanges.call(this, cursorDescription, ordered, callbacks);\n    // get the Kadira Info via the Meteor.EnvironmentalVariable\n    var kadiraInfo = Kadira._getInfo(null, true);\n\n    if(kadiraInfo && ret._multiplexer) {\n      if(!ret._multiplexer.__kadiraTracked) {\n        // new multiplexer\n        ret._multiplexer.__kadiraTracked = true;\n        Kadira.EventBus.emit('pubsub', 'newSubHandleCreated', kadiraInfo.trace);\n        Kadira.models.pubsub.incrementHandleCount(kadiraInfo.trace, false);\n        if(kadiraInfo.trace.type == 'sub') {\n          var ownerInfo = {\n            type: kadiraInfo.trace.type,\n            name: kadiraInfo.trace.name,\n            startTime: (new Date()).getTime()\n          };\n\n          var observerDriver = ret._multiplexer._observeDriver;\n          observerDriver._ownerInfo = ownerInfo;\n          Kadira.EventBus.emit('pubsub', 'observerCreated', ownerInfo);\n          Kadira.models.pubsub.trackCreatedObserver(ownerInfo);\n\n          // We need to send initially polled documents if there are\n          if(observerDriver._polledDocuments) {\n            Kadira.models.pubsub.trackPolledDocuments(ownerInfo, observerDriver._polledDocuments);\n            observerDriver._polledDocuments = 0;\n          }\n\n          // We need to send initially polled documents if there are\n          if(observerDriver._polledDocSize) {\n            Kadira.models.pubsub.trackDocSize(ownerInfo.name, \"polledFetches\", observerDriver._polledDocSize);\n            observerDriver._polledDocSize = 0;\n          }\n\n          // Process _liveUpdatesCounts\n          _.each(observerDriver._liveUpdatesCounts, function(count, key) {\n            Kadira.models.pubsub.trackLiveUpdates(ownerInfo, key, count);\n          });\n\n          // Process docSize\n          _.each(observerDriver._docSize, function(count, key) {\n            Kadira.models.pubsub.trackDocSize(ownerInfo.name, key, count);\n          });\n        }\n      } else {\n        Kadira.EventBus.emit('pubsub', 'cachedSubHandleCreated', kadiraInfo.trace);\n        Kadira.models.pubsub.incrementHandleCount(kadiraInfo.trace, true);\n      }\n    }\n\n    return ret;\n  }\n};\n","wrapStringifyDDP = function() {\n  var originalStringifyDDP = DDPCommon.stringifyDDP;\n\n  DDPCommon.stringifyDDP = function(msg) {\n    var msgString = originalStringifyDDP(msg);\n    var msgSize = Buffer.byteLength(msgString, 'utf8');\n\n    var kadiraInfo = Kadira._getInfo(null, true);\n\n    if(kadiraInfo) {\n      if(kadiraInfo.trace.type === 'method') {\n        Kadira.models.methods.trackMsgSize(kadiraInfo.trace.name, msgSize);\n      }\n\n      return msgString;\n    }\n\n    // 'currentSub' is set when we wrap Subscription object and override\n    // handlers for 'added', 'changed', 'removed' events. (see lib/hijack/wrap_subscription.js)\n    if(Kadira.env.currentSub) {\n      if(Kadira.env.currentSub.__kadiraInfo){\n        Kadira.models.pubsub.trackMsgSize(Kadira.env.currentSub._name, \"initialSent\", msgSize);\n        return msgString;\n      }\n      Kadira.models.pubsub.trackMsgSize(Kadira.env.currentSub._name, \"liveSent\", msgSize);\n      return msgString;\n    }\n\n    Kadira.models.methods.trackMsgSize(\"<not-a-method-or-a-pub>\", msgSize);\n    return msgString;\n  }\n}\n","import {\n  MongoOplogDriver,\n  MongoPollingDriver,\n  Multiplexer,\n  Server,\n  Session,\n  Subscription,\n} from \"./meteorx.js\";\n\nvar logger = Npm.require('debug')('kadira:hijack:instrument');\n\nvar instrumented = false;\nKadira._startInstrumenting = function(callback) {\n  if(instrumented) {\n    callback();\n    return;\n  }\n\n  instrumented = true;\n  wrapStringifyDDP()\n  Meteor.startup(async function () {\n    wrapServer(Server.prototype);\n\n    wrapSession(Session.prototype);\n    wrapSubscription(Subscription.prototype);\n\n    if (MongoOplogDriver) {\n      wrapOplogObserveDriver(MongoOplogDriver.prototype);\n    }\n\n    if (MongoPollingDriver) {\n      wrapPollingObserveDriver(MongoPollingDriver.prototype);\n    }\n\n    if (Multiplexer) {\n      wrapMultiplexer(Multiplexer.prototype);\n    }\n\n    wrapForCountingObservers();\n    hijackDBOps();\n\n    setLabels();\n    callback();\n  });\n};\n\n// We need to instrument this rightaway and it's okay\n// One reason for this is to call `setLables()` function\n// Otherwise, CPU profile can't see all our custom labeling\nKadira._startInstrumenting(function() {\n  console.log('Meteor APM: completed instrumenting the app')\n});\n","import {\n  MongoConnection,\n  MongoCursor,\n} from \"./meteorx.js\";\n\n// This hijack is important to make sure, collections created before\n// we hijack dbOps, even gets tracked.\n//  Meteor does not simply expose MongoConnection object to the client\n//  It picks methods which are necessory and make a binded object and\n//  assigned to the Mongo.Collection\n//  so, even we updated prototype, we can't track those collections\n//  but, this will fix it.\nvar originalOpen = MongoInternals.RemoteCollectionDriver.prototype.open;\nMongoInternals.RemoteCollectionDriver.prototype.open = function open(name) {\n  var self = this;\n  var ret = originalOpen.call(self, name);\n\n  _.each(ret, function(fn, m) {\n    // make sure, it's in the actual mongo connection object\n    // meteorhacks:mongo-collection-utils package add some arbitary methods\n    // which does not exist in the mongo connection\n    if(self.mongo[m]) {\n      ret[m] = function() {\n        Array.prototype.unshift.call(arguments, name);\n        return OptimizedApply(self.mongo, self.mongo[m], arguments);\n      };\n    }\n  });\n\n  return ret;\n};\n\nhijackDBOps = function hijackDBOps() {\n  var mongoConnectionProto = MongoConnection.prototype;\n  //findOne is handled by find - so no need to track it\n  //upsert is handles by update\n  ['find', 'update', 'remove', 'insert', '_ensureIndex', '_dropIndex'].forEach(function(func) {\n    var originalFunc = mongoConnectionProto[func];\n    mongoConnectionProto[func] = function(collName, selector, mod, options) {\n      var payload = {\n        coll: collName,\n        func: func,\n      };\n\n      if(func == 'insert') {\n        //add nothing more to the payload\n      } else if(func == '_ensureIndex' || func == '_dropIndex') {\n        //add index\n        payload.index = JSON.stringify(selector);\n      } else if(func == 'update' && options && options.upsert) {\n        payload.func = 'upsert';\n        payload.selector = JSON.stringify(selector);\n      } else {\n        //all the other functions have selectors\n        payload.selector = JSON.stringify(selector);\n      }\n\n      var kadiraInfo = Kadira._getInfo();\n      if(kadiraInfo) {\n        var eventId = Kadira.tracer.event(kadiraInfo.trace, 'db', payload);\n      }\n\n      //this cause V8 to avoid any performance optimizations, but this is must to use\n      //otherwise, if the error adds try catch block our logs get messy and didn't work\n      //see: issue #6\n      try{\n        var ret = originalFunc.apply(this, arguments);\n        //handling functions which can be triggered with an asyncCallback\n        var endOptions = {};\n\n        if(HaveAsyncCallback(arguments)) {\n          endOptions.async = true;\n        }\n\n        if(func == 'update') {\n          // upsert only returns an object when called `upsert` directly\n          // otherwise it only act an update command\n          if(options && options.upsert && typeof ret == 'object') {\n            endOptions.updatedDocs = ret.numberAffected;\n            endOptions.insertedId = ret.insertedId;\n          } else {\n            endOptions.updatedDocs = ret;\n          }\n        } else if(func == 'remove') {\n          endOptions.removedDocs = ret;\n        }\n\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, endOptions);\n        }\n      } catch(ex) {\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, {err: ex.message});\n        }\n        throw ex;\n      }\n\n      return ret;\n    };\n  });\n\n  var cursorProto = MongoCursor.prototype;\n  ['forEach', 'map', 'fetch', 'count', 'observeChanges', 'observe', 'rewind'].forEach(function(type) {\n    var originalFunc = cursorProto[type];\n    cursorProto[type] = function() {\n      var cursorDescription = this._cursorDescription;\n      var payload = Object.assign(Object.create(null), {\n        coll: cursorDescription.collectionName,\n        selector: JSON.stringify(cursorDescription.selector),\n        func: type,\n        cursor: true\n      });\n\n      if(cursorDescription.options) {\n        var cursorOptions = _.pick(cursorDescription.options, ['fields', 'sort', 'limit']);\n        for(var field in cursorOptions) {\n          var value = cursorOptions[field]\n          if(typeof value == 'object') {\n            value = JSON.stringify(value);\n          }\n          payload[field] = value;\n        }\n      };\n\n      var kadiraInfo = Kadira._getInfo();\n      if(kadiraInfo) {\n        var eventId = Kadira.tracer.event(kadiraInfo.trace, 'db', payload);\n      }\n\n      try{\n        var ret = originalFunc.apply(this, arguments);\n\n        var endData = {};\n        if(type == 'observeChanges' || type == 'observe') {\n          var observerDriver;\n          endData.oplog = false;\n          // get data written by the multiplexer\n          endData.wasMultiplexerReady = ret._wasMultiplexerReady;\n          endData.queueLength = ret._queueLength;\n          endData.elapsedPollingTime = ret._elapsedPollingTime;\n\n          if(ret._multiplexer) {\n            // older meteor versions done not have an _multiplexer value\n            observerDriver = ret._multiplexer._observeDriver;\n            if(observerDriver) {\n              observerDriver = ret._multiplexer._observeDriver;\n              var observerDriverClass = observerDriver.constructor;\n              var usesOplog = typeof observerDriverClass.cursorSupported == 'function';\n              endData.oplog = usesOplog;\n              var size = 0;\n              ret._multiplexer._cache.docs.forEach(function() {size++});\n              endData.noOfCachedDocs = size;\n\n              // if multiplexerWasNotReady, we need to get the time spend for the polling\n              if(!ret._wasMultiplexerReady) {\n                endData.initialPollingTime = observerDriver._lastPollTime;\n              }\n            }\n          }\n\n          if(!endData.oplog) {\n            // let's try to find the reason\n            var reasonInfo = Kadira.checkWhyNoOplog(cursorDescription, observerDriver);\n            endData.noOplogCode = reasonInfo.code;\n            endData.noOplogReason = reasonInfo.reason;\n            endData.noOplogSolution = reasonInfo.solution;\n          }\n        } else if(type == 'fetch' || type == 'map'){\n          //for other cursor operation\n\n          endData.docsFetched = ret.length;\n\n          if(type == 'fetch') {\n            var coll = cursorDescription.collectionName;\n            var query = cursorDescription.selector;\n            var opts = cursorDescription.options;\n            var docSize = Kadira.docSzCache.getSize(coll, query, opts, ret) * ret.length;\n            endData.docSize = docSize;\n\n            if(kadiraInfo) {\n              if(kadiraInfo.trace.type === 'method') {\n                Kadira.models.methods.trackDocSize(kadiraInfo.trace.name, docSize);\n              } else if(kadiraInfo.trace.type === 'sub') {\n                Kadira.models.pubsub.trackDocSize(kadiraInfo.trace.name, \"cursorFetches\", docSize);\n              }\n            } else {\n              // Fetch with no kadira info are tracked as from a null method\n              Kadira.models.methods.trackDocSize(\"<not-a-method-or-a-pub>\", docSize);\n            }\n\n            // TODO: Add doc size tracking to `map` as well.\n          }\n        }\n\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, endData);\n        }\n        return ret;\n      } catch(ex) {\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, {err: ex.message});\n        }\n        throw ex;\n      }\n    };\n  });\n};\n","var originalCall = HTTP.call;\n\nHTTP.call = function(method, url) {\n  var kadiraInfo = Kadira._getInfo();\n  if(kadiraInfo) {\n    var eventId = Kadira.tracer.event(kadiraInfo.trace, 'http', {method: method, url: url});\n  }\n\n  try {\n    var response = originalCall.apply(this, arguments);\n\n    //if the user supplied an asynCallback, we don't have a response object and it handled asynchronously\n    //we need to track it down to prevent issues like: #3\n    var endOptions = HaveAsyncCallback(arguments)? {async: true}: {statusCode: response.statusCode};\n    if(eventId) {\n      Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, endOptions);\n    }\n    return response;\n  } catch(ex) {\n    if(eventId) {\n      Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, {err: ex.message});\n    }\n    throw ex;\n  }\n};","var originalSend = Email.send;\n\nEmail.send = function(options) {\n  var kadiraInfo = Kadira._getInfo();\n  if(kadiraInfo) {\n    var data = _.pick(options, 'from', 'to', 'cc', 'bcc', 'replyTo');\n    var eventId = Kadira.tracer.event(kadiraInfo.trace, 'email', data);\n  }\n  try {\n    var ret = originalSend.call(this, options);\n    if(eventId) {\n      Kadira.tracer.eventEnd(kadiraInfo.trace, eventId);\n    }\n    return ret;\n  } catch(ex) {\n    if(eventId) {\n      Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, {err: ex.message});\n    }\n    throw ex;\n  }\n};","var Fibers = Npm.require('fibers');\n\nvar originalYield = Fibers.yield;\nFibers.yield = function() {\n  var kadiraInfo = Kadira._getInfo();\n  if(kadiraInfo) {\n    var eventId = Kadira.tracer.event(kadiraInfo.trace, 'async');;\n    if(eventId) {\n      Fibers.current._apmEventId = eventId;\n    }\n  }\n\n  return originalYield();\n};\n\nvar originalRun = Fibers.prototype.run;\nFibers.prototype.run = function(val) {\n  if(this._apmEventId) {\n    var kadiraInfo = Kadira._getInfo(this);\n    if(kadiraInfo) {\n      Kadira.tracer.eventEnd(kadiraInfo.trace, this._apmEventId);\n      this._apmEventId = null;\n    }\n  }\n  return originalRun.call(this, val);\n};\n","TrackUncaughtExceptions = function () {\n  process.on('uncaughtException', function (err) {\n    // skip errors with `_skipKadira` flag\n    if(err._skipKadira) {\n      return;\n    }\n\n    // let the server crash normally if error tracking is disabled\n    if(!Kadira.options.enableErrorTracking) {\n      printErrorAndKill(err);\n    }\n\n    // looking for already tracked errors and throw them immediately\n    // throw error immediately if kadira is not ready\n    if(err._tracked || !Kadira.connected) {\n      printErrorAndKill(err);\n    }\n\n    var trace = getTrace(err, 'server-crash', 'uncaughtException');\n    Kadira.models.error.trackError(err, trace);\n    Kadira._sendPayload(function () {\n      clearTimeout(timer);\n      throwError(err);\n    });\n\n    var timer = setTimeout(function () {\n      throwError(err);\n    }, 1000*10);\n\n    function throwError(err) {\n      // sometimes error came back from a fiber.\n      // But we don't fibers to track that error for us\n      // That's why we throw the error on the nextTick\n      process.nextTick(function() {\n        // we need to mark this error where we really need to throw\n        err._tracked = true;\n        printErrorAndKill(err);\n      });\n    }\n  });\n\n  function printErrorAndKill(err) {\n    // since we are capturing error, we are also on the error message.\n    // so developers think we are also reponsible for the error.\n    // But we are not. This will fix that.\n    console.error(err.stack);\n    process.exit(7);\n  }\n}\n\nTrackMeteorDebug = function () {\n  var originalMeteorDebug = Meteor._debug;\n  Meteor._debug = function (message, stack) {\n    if(!Kadira.options.enableErrorTracking) {\n      return originalMeteorDebug.call(this, message, stack);\n    }\n\n    // We've changed `stack` into an object at method and sub handlers so we can\n    // ignore them here. These errors are already tracked so don't track again.\n    if(stack && stack.stack) {\n      stack = stack.stack;\n      // Restore so origionalMeteorDebug shows the stack as a string instead as\n      // an object\n      arguments[1] = stack;\n    } else {\n      // only send to the server, if only connected to kadira\n      if(Kadira.connected) {\n        var error = new Error(message);\n        error.stack = stack;\n        var trace = getTrace(error, 'server-internal', 'Meteor._debug');\n        Kadira.models.error.trackError(error, trace);\n      }\n    }\n\n    return originalMeteorDebug.apply(this, arguments);\n  }\n}\n\nfunction getTrace(err, type, subType) {\n  return {\n    type: type,\n    subType: subType,\n    name: err.message,\n    errored: true,\n    at: Kadira.syncedDate.getTime(),\n    events: [\n      ['start', 0, {}],\n      ['error', 0, {error: {message: err.message, stack: err.stack}}]\n    ],\n    metrics: {\n      total: 0\n    }\n  };\n}\n","import {\n  Session,\n  Multiplexer,\n  MongoConnection,\n  MongoCursor,\n} from \"./meteorx.js\";\n\nsetLabels = function () {\n  // name Session.prototype.send\n  var originalSend = Session.prototype.send;\n  Session.prototype.send = function kadira_Session_send (msg) {\n    return originalSend.call(this, msg);\n  }\n\n  // name Multiplexer initial adds\n  var originalSendAdds = Multiplexer.prototype._sendAdds;\n  Multiplexer.prototype._sendAdds = function kadira_Multiplexer_sendAdds (handle) {\n    return originalSendAdds.call(this, handle);\n  }\n\n  // name MongoConnection insert\n  var originalMongoInsert = MongoConnection.prototype._insert;\n  MongoConnection.prototype._insert = function kadira_MongoConnection_insert (coll, doc, cb) {\n    return originalMongoInsert.call(this, coll, doc, cb);\n  }\n\n  // name MongoConnection update\n  var originalMongoUpdate = MongoConnection.prototype._update;\n  MongoConnection.prototype._update = function kadira_MongoConnection_update (coll, selector, mod, options, cb) {\n    return originalMongoUpdate.call(this, coll, selector, mod, options, cb);\n  }\n\n  // name MongoConnection remove\n  var originalMongoRemove = MongoConnection.prototype._remove;\n  MongoConnection.prototype._remove = function kadira_MongoConnection_remove (coll, selector, cb) {\n    return originalMongoRemove.call(this, coll, selector, cb);\n  }\n\n  // name Pubsub added\n  var originalPubsubAdded = Session.prototype.sendAdded;\n  Session.prototype.sendAdded = function kadira_Session_sendAdded (coll, id, fields) {\n    return originalPubsubAdded.call(this, coll, id, fields);\n  }\n\n  // name Pubsub changed\n  var originalPubsubChanged = Session.prototype.sendChanged;\n  Session.prototype.sendChanged = function kadira_Session_sendChanged (coll, id, fields) {\n    return originalPubsubChanged.call(this, coll, id, fields);\n  }\n\n  // name Pubsub removed\n  var originalPubsubRemoved = Session.prototype.sendRemoved;\n  Session.prototype.sendRemoved = function kadira_Session_sendRemoved (coll, id) {\n    return originalPubsubRemoved.call(this, coll, id);\n  }\n\n  // name MongoCursor forEach\n  var originalCursorForEach = MongoCursor.prototype.forEach;\n  MongoCursor.prototype.forEach = function kadira_Cursor_forEach () {\n    return originalCursorForEach.apply(this, arguments);\n  }\n\n  // name MongoCursor map\n  var originalCursorMap = MongoCursor.prototype.map;\n  MongoCursor.prototype.map = function kadira_Cursor_map () {\n    return originalCursorMap.apply(this, arguments);\n  }\n\n  // name MongoCursor fetch\n  var originalCursorFetch = MongoCursor.prototype.fetch;\n  MongoCursor.prototype.fetch = function kadira_Cursor_fetch () {\n    return originalCursorFetch.apply(this, arguments);\n  }\n\n  // name MongoCursor count\n  var originalCursorCount = MongoCursor.prototype.count;\n  MongoCursor.prototype.count = function kadira_Cursor_count () {\n    return originalCursorCount.apply(this, arguments);\n  }\n\n  // name MongoCursor observeChanges\n  var originalCursorObserveChanges = MongoCursor.prototype.observeChanges;\n  MongoCursor.prototype.observeChanges = function kadira_Cursor_observeChanges () {\n    return originalCursorObserveChanges.apply(this, arguments);\n  }\n\n  // name MongoCursor observe\n  var originalCursorObserve = MongoCursor.prototype.observe;\n  MongoCursor.prototype.observe = function kadira_Cursor_observe () {\n    return originalCursorObserve.apply(this, arguments);\n  }\n\n  // name MongoCursor rewind\n  var originalCursorRewind = MongoCursor.prototype.rewind;\n  MongoCursor.prototype.rewind = function kadira_Cursor_rewind () {\n    return originalCursorRewind.apply(this, arguments);\n  }\n\n  // name CrossBar listen\n  var originalCrossbarListen = DDPServer._Crossbar.prototype.listen;\n  DDPServer._Crossbar.prototype.listen = function kadira_Crossbar_listen (trigger, callback) {\n    return originalCrossbarListen.call(this, trigger, callback);\n  }\n\n  // name CrossBar fire\n  var originalCrossbarFire = DDPServer._Crossbar.prototype.fire;\n  DDPServer._Crossbar.prototype.fire = function kadira_Crossbar_fire (notification) {\n    return originalCrossbarFire.call(this, notification);\n  }\n}\n","// Various tricks for accessing \"private\" Meteor APIs borrowed from the\n// now-unmaintained meteorhacks:meteorx package.\n\nimport { get } from \"../utils.js\";\n\nexport const Server = Meteor.server.constructor;\n\nfunction getSession() {\n  const fakeSocket = {\n    send() {},\n    close() {},\n    headers: []\n  };\n\n  const server = Meteor.server;\n\n  server._handleConnect(fakeSocket, {\n    msg: \"connect\",\n    version: \"pre1\",\n    support: [\"pre1\"]\n  });\n\n  const session = fakeSocket._meteorSession;\n\n  server._removeSession(session);\n\n  return session;\n}\n\nconst session = getSession();\nexport const Session = session.constructor;\n\nconst collection = new Mongo.Collection(\"__dummy_coll_\" + Random.id());\ncollection.findOne();\nconst cursor = collection.find();\nexport const MongoCursor = cursor.constructor;\n\nfunction getMultiplexer(cursor) {\n  const handle = cursor.observeChanges({\n    added() {}\n  });\n  handle.stop();\n  return handle._multiplexer;\n}\n\nexport const Multiplexer = getMultiplexer(cursor).constructor;\n\n// Due to Meteor 2.7.4, defaultRemoteCollectionDriver can be Async now https://github.com/meteor/meteor/pull/12057\nconst mongoDriver = MongoInternals.defaultRemoteCollectionDriver()\nexport const MongoConnection =\n  (mongoDriver.await ? mongoDriver.await() : mongoDriver).mongo.constructor;\n\nfunction getSubscription(session) {\n  const subId = Random.id();\n\n  session._startSubscription(function () {\n    this.ready();\n  }, subId, [], \"__dummy_pub_\" + Random.id());\n\n  const subscription = get(session._namedSubs, subId);\n\n  session._stopSubscription(subId);\n\n  return subscription;\n}\n\nexport const Subscription = getSubscription(session).constructor;\n\nfunction getObserverDriver(cursor) {\n  const multiplexer = getMultiplexer(cursor);\n  return multiplexer && multiplexer._observeDriver || null;\n}\n\nfunction getMongoOplogDriver() {\n  const driver = getObserverDriver(cursor);\n  let MongoOplogDriver = driver && driver.constructor || null;\n  if (MongoOplogDriver &&\n      typeof MongoOplogDriver.cursorSupported !== \"function\") {\n    return null;\n  }\n  return MongoOplogDriver;\n}\n\nexport const MongoOplogDriver = getMongoOplogDriver();\n\nfunction getMongoPollingDriver() {\n  const cursor = collection.find({}, {\n    limit: 20,\n    _disableOplog: true,\n  });\n\n  const driver = getObserverDriver(cursor);\n\n  // verify observer driver is a polling driver\n  if (driver && typeof driver.constructor.cursorSupported === \"undefined\") {\n    return driver.constructor;\n  }\n\n  return null;\n}\n\nexport const MongoPollingDriver = getMongoPollingDriver();\n","Kadira._parseEnv = function (env) {\n  var options = {};\n  for(var name in env) {\n    var info = Kadira._parseEnv._options[name];\n    var value = env[name];\n    if(info && value) {\n      options[info.name] = info.parser(value);\n    }\n  }\n\n  return options;\n};\n\n\nKadira._parseEnv.parseInt = function (str) {\n  var num = parseInt(str);\n  if(num || num === 0) return num;\n  throw new Error('Kadira: Match Error: \"'+num+'\" is not a number');\n};\n\n\nKadira._parseEnv.parseBool = function (str) {\n  str = str.toLowerCase();\n  if(str === 'true') return true;\n  if(str === 'false') return false;\n  throw new Error('Kadira: Match Error: '+str+' is not a boolean');\n};\n\n\nKadira._parseEnv.parseUrl = function (str) {\n  return str;\n};\n\n\nKadira._parseEnv.parseString = function (str) {\n  return str;\n};\n\n\nKadira._parseEnv._options = {\n  // delay to send the initial ping to the kadira engine after page loads\n  APM_OPTIONS_CLIENT_ENGINE_SYNC_DELAY: {\n    name: 'clientEngineSyncDelay',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // time between sending errors to the engine\n  APM_OPTIONS_ERROR_DUMP_INTERVAL: {\n    name: 'errorDumpInterval',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // no of errors allowed in a given interval\n  APM_OPTIONS_MAX_ERRORS_PER_INTERVAL: {\n    name: 'maxErrorsPerInterval',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // a zone.js specific option to collect the full stack trace(which is not much useful)\n  APM_OPTIONS_COLLECT_ALL_STACKS: {\n    name: 'collectAllStacks',\n    parser: Kadira._parseEnv.parseBool,\n  },\n  // enable error tracking (which is turned on by default)\n  APM_OPTIONS_ENABLE_ERROR_TRACKING: {\n    name: 'enableErrorTracking',\n    parser: Kadira._parseEnv.parseBool,\n  },\n  // kadira engine endpoint\n  APM_OPTIONS_ENDPOINT: {\n    name: 'endpoint',\n    parser: Kadira._parseEnv.parseUrl,\n  },\n  // define the hostname of the current running process\n  APM_OPTIONS_HOSTNAME: {\n    name: 'hostname',\n    parser: Kadira._parseEnv.parseString,\n  },\n  // interval between sending data to the kadira engine from the server\n  APM_OPTIONS_PAYLOAD_TIMEOUT: {\n    name: 'payloadTimeout',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // set HTTP/HTTPS proxy\n  APM_OPTIONS_PROXY: {\n    name: 'proxy',\n    parser: Kadira._parseEnv.parseUrl,\n  },\n  // number of items cached for tracking document size\n  APM_OPTIONS_DOCUMENT_SIZE_CACHE_SIZE: {\n    name: 'documentSizeCacheSize',\n    parser: Kadira._parseEnv.parseInt,\n  },\n};\n","Kadira._connectWithEnv = function() {\n  const settings = Meteor.settings && Meteor.settings.packages &&\n    Meteor.settings.packages['mdg:meteor-apm-agent'];\n\n  if (settings && settings.isDisabled) {\n    console.log('Meteor APM: not connected because it was disabled in settings');\n    return;\n  }\n\n  if (process.env.APM_APP_ID && process.env.APM_APP_SECRET && process.env.APM_OPTIONS_ENDPOINT) {\n    const options = Kadira._parseEnv(process.env);\n\n    Kadira.connect(\n      process.env.APM_APP_ID,\n      process.env.APM_APP_SECRET,\n      options\n    );\n\n    Kadira.connect = function() {\n      throw new Error('Meteor APM has already connected using credentials from Environment Variables');\n    };\n  }\n\n  if (settings && settings.APM_APP_ID && settings.APM_APP_SECRET) {\n    const options = Kadira._parseEnv(settings);\n\n    Kadira.connect(\n      settings.APM_APP_ID,\n      settings.APM_APP_SECRET,\n      options\n    );\n\n    Kadira.connect = function() {\n      throw new Error('Meteor APM has already connected using credentials from app Meteor.settings');\n    };\n  }\n  // other forms of Kadira.connect are not supported\n};\n\n// Try to connect automatically\nKadira._connectWithEnv();\n"]}